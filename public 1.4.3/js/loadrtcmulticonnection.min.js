function rtcEvent(a,b){var c=new CustomEvent("rtcevent",{detail:{evname:a,data:b}});document.dispatchEvent(c)}function loadRTCMultiConnection(){!function(){function a(a,d){function h(a){f.deletePeer(a)}function j(a){if(f.socketAutoReConnect=!0,f.socket)return void(a&&a(f.socket));if("undefined"==typeof b)if("undefined"!=typeof FirebaseConnection)window.SocketConnection=FirebaseConnection;else{if("undefined"==typeof PubNubConnection)throw"SocketConnection.js seems missed.";window.SocketConnection=PubNubConnection}new b(f,function(b){a&&a(f.socket)})}function k(a,b){if(f.dontCaptureUserMedia||a.isDataOnly)return void b();var c={};a.localPeerSdpConstraints.OfferToReceiveAudio&&(c.audio=f.mediaConstraints.audio),a.localPeerSdpConstraints.OfferToReceiveVideo&&(c.video=f.mediaConstraints.video);var d=a.session||f.session;return d.oneway&&"two-way"!==d.audio&&"two-way"!==d.video&&"two-way"!==d.screen?void b():(d.oneway&&d.audio&&"two-way"===d.audio&&(d={audio:!0}),void((d.audio||d.video||d.screen)&&(d.screen?f.getScreenConstraints(function(a,c){f.invokeGetUserMedia({audio:!!z(f)&&A(c),video:c,isScreen:!0},!d.audio&&!d.video||z(f)?b:f.invokeGetUserMedia(null,b))}):(d.audio||d.video)&&f.invokeGetUserMedia(null,b,d))))}function l(a,b){f.closeBeforeUnload&&(f.isInitiator===!0&&f.dontMakeMeModerator(),f.peers.getAllParticipants().forEach(function(a){g.onNegotiationNeeded({userLeft:!0},a),f.peers[a]&&f.peers[a].peer&&f.peers[a].peer.close(),delete f.peers[a]}),b||f.closeSocket(),f.broadcasters=[],f.isInitiator=!1)}function m(a,b){return a?(b.audio&&a.getAudioTracks().forEach(function(a){a.applyConstraints(b.audio)}),void(b.video&&a.getVideoTracks().forEach(function(a){a.applyConstraints(b.video)}))):void(f.enableLogs&&console.error("No stream to applyConstraints."))}function n(a,b,c){return b?void g.replaceTrack(a,b,c):void f.peers.getAllParticipants().forEach(function(b){g.replaceTrack(a,b,c)})}function o(){if(f.isInitiator&&!f.session.oneway&&!f.session.broadcast&&"many-to-many"===f.direction){var a=f.broadcasters[0],b=[];f.broadcasters.forEach(function(c){c!==a&&b.push(c)}),f.autoCloseEntireSession||f.shiftModerationControl(a,b,!0)}}d=d||{useDefaultDevices:!0};var f=this;f.channel=f.sessionid=(a||location.href.replace(/\/|:|#|\?|\$|\^|%|\.|`|~|!|\+|@|\[|\||]|\|*. /g,"").split("\n").join("").split("\r").join(""))+"";var g=new c(f);g.onGettingLocalMedia=function(a){a.type="local",f.setStreamEndHandler(a),s(a,function(b){b.id=a.streamid,b.muted=!0,b.volume=0,f.attachStreams.indexOf(a)===-1&&f.attachStreams.push(a),"undefined"!=typeof V&&V.setHandlers(a,!0,f),f.streamEvents[a.streamid]={stream:a,type:"local",mediaElement:b,userid:f.userid,extra:f.extra,streamid:a.streamid,blobURL:b.src||URL.createObjectURL(a),isAudioMuted:!0},p(f,f.streamEvents[a.streamid]),q(f,f.streamEvents[a.streamid]),f.onstream(f.streamEvents[a.streamid])},f)},g.onGettingRemoteMedia=function(a,b){a.type="remote",f.setStreamEndHandler(a,"remote-stream"),s(a,function(c){c.id=a.streamid,"undefined"!=typeof V&&V.setHandlers(a,!1,f),f.streamEvents[a.streamid]={stream:a,type:"remote",userid:b,extra:f.peers[b]?f.peers[b].extra:{},mediaElement:c,streamid:a.streamid,blobURL:c.src||URL.createObjectURL(a)},q(f,f.streamEvents[a.streamid]),f.onstream(f.streamEvents[a.streamid])},f)},g.onRemovingRemoteMedia=function(a,b){var c=f.streamEvents[a.streamid];c||(c={stream:a,type:"remote",userid:b,extra:f.peers[b]?f.peers[b].extra:{},streamid:a.streamid,mediaElement:f.streamEvents[a.streamid]?f.streamEvents[a.streamid].mediaElement:null}),f.onstreamended(c),delete f.streamEvents[a.streamid]},g.onNegotiationNeeded=function(a,b,c){j(function(){f.socket.emit(f.socketMessageEvent,"password"in a?a:{remoteUserId:a.remoteUserId||b,message:a,sender:f.userid},c||function(){})})},g.onUserLeft=h,g.disconnectWith=function(a,b){f.socket&&f.socket.emit("disconnect-with",a,b||function(){}),f.deletePeer(a)},f.broadcasters=[],f.socketOptions={forceNew:!0,transport:"polling"},f.openOrJoin=function(a,b){f.checkPresence(a,function(c,d){if("function"==typeof b&&(b(c,d),b=null),c){f.sessionid=d;var e=!1,h=!1,i=!!f.session.oneway,j=v(f.session);h={OfferToReceiveAudio:f.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:f.sdpConstraints.mandatory.OfferToReceiveVideo},e={OfferToReceiveAudio:i?!!f.session.audio:f.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:i?!!f.session.video||!!f.session.screen:f.sdpConstraints.mandatory.OfferToReceiveVideo};var l={remoteUserId:f.sessionid,message:{newParticipationRequest:!0,isOneWay:i,isDataOnly:j,localPeerSdpConstraints:e,remotePeerSdpConstraints:h},sender:f.userid,password:b||!1};return void k(l.message,function(){g.onNegotiationNeeded(l)})}f.userid;f.userid=f.sessionid=a||f.sessionid,f.userid+="",f.socket.emit("changed-uuid",f.userid),b&&f.socket.emit("set-password",b),f.isInitiator=!0,v(f.session)||f.captureUserMedia()})},f.open=function(a,b){f.userid;return f.userid=f.sessionid=a||f.sessionid,f.userid+="",f.isInitiator=!0,j(function(){f.socket.emit("changed-uuid",f.userid),1==b&&f.becomePublicModerator()}),v(f.session)?void("function"==typeof b&&b()):void f.captureUserMedia("function"==typeof b?b:null)},f.becomePublicModerator=function(){f.isInitiator&&f.socket.emit("become-a-public-moderator")},f.dontMakeMeModerator=function(){f.socket.emit("dont-make-me-moderator")},f.deletePeer=function(a){if(a){if(f.onleave({userid:a,extra:f.peers[a]?f.peers[a].extra:{}}),f.peers[a]){f.peers[a].streams.forEach(function(a){a.stop()});var b=f.peers[a].peer;if(b&&"closed"!==b.iceConnectionState)try{b.close()}catch(a){}f.peers[a]&&(f.peers[a].peer=null,delete f.peers[a])}if(f.broadcasters.indexOf(a)!==-1){var c=[];f.broadcasters.forEach(function(b){b!==a&&c.push(b)}),f.broadcasters=c,o()}}},f.rejoin=function(a){if(!f.isInitiator&&a&&Object.keys(a).length){var b={};f.peers[a.remoteUserId]&&(b=f.peers[a.remoteUserId].extra,f.deletePeer(a.remoteUserId)),a&&a.remoteUserId&&(f.join(a.remoteUserId),f.onReConnecting({userid:a.remoteUserId,extra:b}))}},f.join=f.connect=function(a,b){f.sessionid=!!a&&(a.sessionid||a.remoteUserId||a)||f.sessionid,f.sessionid+="";var c=!1,d=!1,e=!1,h=!1;if(a&&a.session||!a||"string"==typeof a){var i=a?a.session||f.session:f.session;e=!!i.oneway,h=v(i),d={OfferToReceiveAudio:f.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:f.sdpConstraints.mandatory.OfferToReceiveVideo},c={OfferToReceiveAudio:e?!!f.session.audio:f.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e?!!f.session.video||!!f.session.screen:f.sdpConstraints.mandatory.OfferToReceiveVideo}}b=b||{};var l=function(){};"function"==typeof b&&(l=b,b={}),"undefined"!=typeof b.localPeerSdpConstraints&&(c=b.localPeerSdpConstraints),"undefined"!=typeof b.remotePeerSdpConstraints&&(d=b.remotePeerSdpConstraints),"undefined"!=typeof b.isOneWay&&(e=b.isOneWay),"undefined"!=typeof b.isDataOnly&&(h=b.isDataOnly);var m={remoteUserId:f.sessionid,message:{newParticipationRequest:!0,isOneWay:e,isDataOnly:h,localPeerSdpConstraints:c,remotePeerSdpConstraints:d},sender:f.userid,password:!1};return k(m.message,function(){j(function(){f.peers[f.sessionid]||(g.onNegotiationNeeded(m),l())})}),m},f.connectWithAllParticipants=function(a){g.onNegotiationNeeded("connectWithAllParticipants",a||f.sessionid)},f.removeFromBroadcastersList=function(a){g.onNegotiationNeeded("removeFromBroadcastersList",a||f.sessionid),f.peers.getAllParticipants(a||f.sessionid).forEach(function(a){g.onNegotiationNeeded("dropPeerConnection",a),f.deletePeer(a)}),f.attachStreams.forEach(function(a){a.stop()})},f.getUserMedia=f.captureUserMedia=function(a,b){a=a||function(){};var c=b||f.session;return f.dontCaptureUserMedia||v(c)?void a():void((c.audio||c.video||c.screen)&&(c.screen?f.getScreenConstraints(function(d,e){if(d)throw d;f.invokeGetUserMedia({audio:!!z(f)&&A(e),video:e,isScreen:!0},function(d){if((c.audio||c.video)&&!z(f)){var e={};for(var g in c)"screen"!==g&&(e[g]=c[g]);return void f.invokeGetUserMedia(b,a,e)}a(d)})}):(c.audio||c.video)&&f.invokeGetUserMedia(b,a,c)))},f.closeBeforeUnload=!0,window.addEventListener("beforeunload",l,!1),f.userid=r(),f.changeUserId=function(a,b){f.userid=a||r(),f.socket.emit("changed-uuid",f.userid,b||function(){})},f.extra={},f.attachStreams=[],f.session={audio:!0,video:!0},f.enableFileSharing=!1,f.bandwidth={screen:512,audio:128,video:512},f.codecs={audio:"opus",video:"VP9"},f.processSdp=function(a){return i||e?a:(a=J.setApplicationSpecificBandwidth(a,f.bandwidth,!!f.session.screen),a=J.setVideoBitrates(a,{min:8*f.bandwidth.video*1024,max:8*f.bandwidth.video*1024}),a=J.setOpusAttributes(a,{maxaveragebitrate:8*f.bandwidth.audio*1024,maxplaybackrate:8*f.bandwidth.audio*1024,stereo:1,maxptime:3}),"VP9"===f.codecs.video&&(a=J.preferVP9(a)),"H264"===f.codecs.video&&(a=J.removeVPX(a)),"G722"===f.codecs.audio&&(a=J.removeNonG722(a)),a)},"undefined"!=typeof J&&(f.BandwidthHandler=f.CodecsHandler=J),f.mediaConstraints={audio:{mandatory:{},optional:[{bandwidth:8*f.bandwidth.audio*1024||1048576}]},video:{mandatory:{},optional:[{bandwidth:8*f.bandwidth.video*1024||1048576},{facingMode:"environment"}]}},e&&(f.mediaConstraints={audio:!0,video:!0}),d.useDefaultDevices||i||DetectRTC.load(function(){var a,b;if(DetectRTC.MediaDevices.forEach(function(c){"audioinput"===c.kind&&f.mediaConstraints.audio!==!1&&(a=c),"videoinput"===c.kind&&f.mediaConstraints.video!==!1&&(b=c)}),a){if(e)return void(f.mediaConstraints.audio!==!0?f.mediaConstraints.audio.deviceId=a.id:f.mediaConstraints.audio={deviceId:a.id});1==f.mediaConstraints.audio&&(f.mediaConstraints.audio={mandatory:{},optional:[]}),f.mediaConstraints.audio.optional||(f.mediaConstraints.audio.optional=[]);var c=[{sourceId:a.id}];f.mediaConstraints.audio.optional=c.concat(f.mediaConstraints.audio.optional)}if(b){if(e)return void(f.mediaConstraints.video!==!0?f.mediaConstraints.video.deviceId=b.id:f.mediaConstraints.video={deviceId:b.id});1==f.mediaConstraints.video&&(f.mediaConstraints.video={mandatory:{},optional:[]}),f.mediaConstraints.video.optional||(f.mediaConstraints.video.optional=[]);var c=[{sourceId:b.id}];f.mediaConstraints.video.optional=c.concat(f.mediaConstraints.video.optional)}}),f.sdpConstraints={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0},optional:[{VoiceActivityDetection:!1}]},f.optionalArgument={optional:[{DtlsSrtpKeyAgreement:!0},{googImprovedWifiBwe:!0},{googScreencastMinBitrate:300},{googIPv6:!0},{googDscp:!0},{googCpuUnderuseThreshold:55},{googCpuOveruseThreshold:85},{googSuspendBelowMinBitrate:!0},{googCpuOveruseDetection:!0}],mandatory:{}},f.iceServers=R.getIceServers(f),f.candidates={host:!0,stun:!0,turn:!0},f.iceProtocols={tcp:!0,udp:!0},f.onopen=function(a){f.enableLogs&&console.info("Data connection has been opened between you & ",a.userid)},f.onclose=function(a){f.enableLogs&&console.warn("Data connection has been closed between you & ",a.userid)},f.onerror=function(a){f.enableLogs&&console.error(a.userid,"data-error",a)},f.onmessage=function(a){console.log("data-message",a.userid,a.data),f.enableLogs&&console.debug("data-message",a.userid,a.data)},f.send=function(a,b){f.peers.send(a,b)},f.close=f.disconnect=f.leave=function(){l(!1,!0)},f.closeEntireSession=function(a){a=a||function(){},f.socket.emit("close-entire-session",function b(){return f.getAllParticipants().length?void setTimeout(b,100):(f.onEntireSessionClosed({sessionid:f.sessionid,userid:f.userid,extra:f.extra}),void f.changeUserId(null,function(){f.close(),a()}))})},f.onEntireSessionClosed=function(a){f.enableLogs&&console.info("Entire session is closed: ",a.sessionid,a.extra)},f.onstream=function(a){var b=f.videosContainer;b.insertBefore(a.mediaElement,b.firstChild),a.mediaElement.play(),setTimeout(function(){a.mediaElement.play()},5e3)},f.onstreamended=function(a){a.mediaElement||(a.mediaElement=document.getElementById(a.streamid)),a.mediaElement&&a.mediaElement.parentNode&&(a.mediaElement.parentNode.removeChild(a.mediaElement),rtcEvent("streamended",a))},f.direction="many-to-many",f.removeStream=function(a){var b;return f.attachStreams.forEach(function(c){c.id===a&&(b=c)}),b?(f.peers.getAllParticipants().forEach(function(a){var c=f.peers[a];try{c.peer.removeStream(b)}catch(a){}}),void f.renegotiate()):void console.warn("No such stream exists.",a)},f.addStream=function(a,b){function c(c){a.streamCallback&&a.streamCallback(c),f.renegotiate(b)}return a.getAudioTracks?(f.attachStreams.indexOf(a)===-1&&(a.streamid||(a.streamid=a.id),f.attachStreams.push(a)),void f.renegotiate(b)):v(a)?void f.renegotiate(b):void((a.audio||a.video||a.screen)&&(a.screen?f.getScreenConstraints(function(b,d){return b?"PermissionDeniedError"===b?(a.streamCallback&&a.streamCallback(null),void(f.enableLogs&&console.error("User rejected to share his screen."))):alert(b):void f.invokeGetUserMedia({audio:!!z(f)&&A(d),video:d,isScreen:!0},!a.audio&&!a.video||z(f)?c:f.invokeGetUserMedia(null,c))}):(a.audio||a.video)&&f.invokeGetUserMedia(null,c)))},f.invokeGetUserMedia=function(a,b,c){c||(c=f.session),a||(a=f.mediaConstraints),U({onGettingLocalMedia:function(c){var d=a.video;d&&(d.mediaSource||d.mozMediaSource?c.isScreen=!0:d.mandatory&&d.mandatory.chromeMediaSource&&(c.isScreen=!0)),c.isScreen||(c.isVideo=c.getVideoTracks().length,c.isAudio=!c.isVideo&&c.getAudioTracks().length),g.onGettingLocalMedia(c),b&&b(c)},onLocalMediaError:function(a,b){g.onLocalMediaError(a,b)},localMediaConstraints:a||{audio:!!c.audio&&a.audio,video:!!c.video&&a.video}})},f.applyConstraints=function(a,b){if(!H||!H.prototype.applyConstraints)return void alert("track.applyConstraints is NOT supported in your browser.");if(b){var c;return f.streamEvents[b]&&(c=f.streamEvents[b].stream),void m(c,a)}f.attachStreams.forEach(function(b){m(b,a)})},f.replaceTrack=function(a,b,c){function d(d){f.replaceTrack(d,b,c||a.video||a.screen)}if(a=a||{},!E.prototype.getSenders)return void f.addStream(a);if(a instanceof H)return void n(a,b,c);if(a instanceof y)return a.getVideoTracks().length&&n(a.getVideoTracks()[0],b,!0),void(a.getAudioTracks().length&&n(a.getAudioTracks()[0],b,!1));if(v(a))throw"connection.replaceTrack requires audio and/or video and/or screen.";(a.audio||a.video||a.screen)&&(a.screen?f.getScreenConstraints(function(b,c){return b?alert(b):void f.invokeGetUserMedia({audio:!!z(f)&&A(c),video:c,isScreen:!0},!a.audio&&!a.video||z(f)?d:f.invokeGetUserMedia(null,d))}):(a.audio||a.video)&&f.invokeGetUserMedia(null,d))},f.resetTrack=function(a,b){a||(a=f.getAllParticipants()),"string"==typeof a&&(a=[a]),a.forEach(function(a){var c=f.peers[a].peer;"undefined"!=typeof b&&b!==!0||!c.lastVideoTrack||f.replaceTrack(c.lastVideoTrack,a,!0),"undefined"!=typeof b&&b!==!1||!c.lastAudioTrack||f.replaceTrack(c.lastAudioTrack,a,!1)})},f.renegotiate=function(a){return a?void g.renegotiatePeer(a):void f.peers.getAllParticipants().forEach(function(a){g.renegotiatePeer(a)})},f.setStreamEndHandler=function(a,b){if(a&&a.addEventListener&&(b=!!b,!a.alreadySetEndHandler)){a.alreadySetEndHandler=!0;var c="ended";"oninactive"in a&&(c="inactive"),a.addEventListener(c,function(){a.idInstance&&T.remove(a.idInstance),b||delete f.attachStreams[f.attachStreams.indexOf(a)];var c=f.streamEvents[a.streamid];c||(c={stream:a,streamid:a.streamid,type:b?"remote":"local",userid:f.userid,extra:f.extra,mediaElement:f.streamEvents[a.streamid]?f.streamEvents[a.streamid].mediaElement:null}),c.userid===f.userid&&"remote"===c.type||(f.onstreamended(c),delete f.streamEvents[a.streamid])},!1)}},f.onMediaError=function(a,b){f.enableLogs&&console.error(a,b)},f.addNewBroadcaster=function(a,b){f.socket.isIO||(f.broadcasters.length&&setTimeout(function(){g.connectNewParticipantWithAllBroadcasters(a,b,f.broadcasters.join("|-,-|"))},1e4),f.session.oneway||f.session.broadcast||"many-to-many"!==f.direction||f.broadcasters.indexOf(a)!==-1||(f.broadcasters.push(a),o()))},f.autoCloseEntireSession=!1,f.filesContainer=f.videosContainer=document.body||document.documentElement,f.isInitiator=!1,f.shareFile=g.shareFile,"undefined"!=typeof fa&&fa.handle(f),"undefined"!=typeof ga&&ga.handle(f),f.token=r,f.onNewParticipant=function(a,b){f.acceptParticipationRequest(a,b)},f.acceptParticipationRequest=function(a,b){b.successCallback&&(b.successCallback(),delete b.successCallback),g.createNewPeer(a,b)},f.onShiftedModerationControl=function(a,b){f.acceptModerationControl(a,b)},f.acceptModerationControl=function(a,b){f.isInitiator=!0,f.broadcasters=b,f.peers.getAllParticipants().forEach(function(b){g.onNegotiationNeeded({changedUUID:a,oldUUID:f.userid,newUUID:a},b)}),f.userid=a,f.socket.emit("changed-uuid",f.userid)},f.shiftModerationControl=function(a,b,c){g.onNegotiationNeeded({shiftedModerationControl:!0,broadcasters:b,firedOnLeave:!!c},a)},"undefined"!=typeof V&&(f.StreamsHandler=V),f.onleave=function(a){console.log("userid "+a+" left the room"),rtcEvent("userleft",{connection:f,userid:a})},f.invokeSelectFileDialog=function(a){var b=new FileSelector;b.accept="*.*",b.selectSingleFile(a)},f.getPublicModerators=function(a,b){"function"==typeof a&&(b=a),j(function(){f.socket.emit("get-public-moderators","string"==typeof a?a:"",b)})},f.onmute=function(a){a&&a.mediaElement&&("both"===a.muteType||"video"===a.muteType?(a.mediaElement.src=null,a.mediaElement.pause(),a.mediaElement.poster=a.snapshot||"https://cdn.webrtc-experiment.com/images/muted.png"):"audio"===a.muteType&&(a.mediaElement.muted=!0))},f.onunmute=function(a){a&&a.mediaElement&&a.stream&&("both"===a.unmuteType||"video"===a.unmuteType?(a.mediaElement.poster=null,a.mediaElement.src=URL.createObjectURL(a.stream),a.mediaElement.play()):"audio"===a.unmuteType&&(a.mediaElement.muted=!1))},f.onExtraDataUpdated=function(a){a.status="online",f.onUserStatusChanged(a,!0)},f.onJoinWithPassword=function(a){console.warn(a,"is password protected. Please join with password.")},f.onInvalidPassword=function(a,b){console.warn(a,"is password protected. Please join with valid password. Your old password",b,"is wrong.")},f.onPasswordMaxTriesOver=function(a){console.warn(a,"is password protected. Your max password tries exceeded the limit.")},f.getAllParticipants=function(a){return f.peers.getAllParticipants(a)},"undefined"!=typeof V&&(V.onSyncNeeded=function(a,b,c){f.peers.getAllParticipants().forEach(function(d){g.onNegotiationNeeded({streamid:a,action:b,streamSyncNeeded:!0,type:c||"both"},d)})}),f.connectSocket=function(a){j(a)},f.closeSocket=function(){try{io.sockets={}}catch(a){}f.socket&&("function"==typeof f.socket.disconnect&&f.socket.disconnect(),"function"==typeof f.socket.resetProps&&f.socket.resetProps(),f.socket=null)},f.getSocket=function(a){return f.socket?a&&a(f.socket):j(a),f.socket},f.getRemoteStreams=g.getRemoteStreams;var u=["selectFirst","selectAll","forEach"];if(f.streamEvents={selectFirst:function(a){if(!a){var b;for(var c in f.streamEvents)u.indexOf(c)!==-1||b||(b=f.streamEvents[c]);return b}},selectAll:function(){}},f.socketURL="/",f.socketMessageEvent="RTCMultiConnection-Message",f.socketCustomEvent="RTCMultiConnection-Custom-Message",f.DetectRTC=DetectRTC,f.setCustomSocketEvent=function(a){console.log("called customsocketevent"),a&&(f.socketCustomEvent=a),f.socket&&f.socket.emit("set-custom-socket-event-listener",f.socketCustomEvent)},f.getNumberOfBroadcastViewers=function(a,b){f.socket&&a&&b&&f.socket.emit("get-number-of-users-in-specific-broadcast",a,b)},f.onNumberOfBroadcastViewersUpdated=function(a){f.enableLogs&&f.isInitiator&&console.info("Number of broadcast (",a.broadcastId,") viewers",a.numberOfBroadcastViewers)},f.onUserStatusChanged=function(a,b){f.enableLogs&&!b&&console.info(a.userid,a.status)},f.getUserMediaHandler=U,f.multiPeersHandler=g,f.enableLogs=!0,f.setCustomSocketHandler=function(a){"undefined"!=typeof b&&(b=a)},f.chunkSize=65e3,f.maxParticipantsAllowed=1e3,f.disconnectWith=g.disconnectWith,f.checkPresence=function(a,b){return f.socket?void f.socket.emit("check-presence",(a||f.sessionid)+"",b):void f.connectSocket(function(){f.checkPresence(a,b)})},f.onReadyForOffer=function(a,b){f.multiPeersHandler.createNewPeer(a,b)},f.setUserPreferences=function(a){return f.dontAttachStream&&(a.dontAttachLocalStream=!0),f.dontGetRemoteStream&&(a.dontGetRemoteStream=!0),a},f.updateExtraData=function(){f.socket.emit("extra-data-updated",f.extra)},f.enableScalableBroadcast=!1,f.maxRelayLimitPerUser=3,f.dontCaptureUserMedia=!1,f.dontAttachStream=!1,f.dontGetRemoteStream=!1,f.onReConnecting=function(a){f.enableLogs&&console.info("ReConnecting with",a.userid,"...")},f.beforeAddingStream=function(a){return a},f.beforeRemovingStream=function(a){return a},"undefined"!=typeof $&&(f.checkIfChromeExtensionAvailable=$),"undefined"!=typeof _&&(f.checkIfChromeExtensionAvailable=_),"undefined"!=typeof ba&&(f.getChromeExtensionStatus=ba),f.getScreenConstraints=function(a,b){z(f,b)&&(b=!0),ca(function(b,c){b||(c=f.modifyScreenConstraints(c),a(b,c))},b)},f.modifyScreenConstraints=function(a){return a},f.onPeerStateChanged=function(a){f.enableLogs&&a.iceConnectionState.search(/closed|failed/gi)!==-1&&console.error("Peer connection is closed between you & ",a.userid,a.extra,"state:",a.iceConnectionState)},f.isOnline=!0,t("online",function(){f.isOnline=!0}),t("offline",function(){f.isOnline=!1}),f.isLowBandwidth=!1,navigator&&navigator.connection&&navigator.connection.type&&(f.isLowBandwidth=navigator.connection.type.toString().toLowerCase().search(/wifi|cell/g)!==-1,f.isLowBandwidth)){if(f.bandwidth={audio:30,video:30,screen:30},f.mediaConstraints.audio&&f.mediaConstraints.audio.optional&&f.mediaConstraints.audio.optional.length){var w=[];f.mediaConstraints.audio.optional.forEach(function(a){"undefined"==typeof a.bandwidth&&w.push(a)}),f.mediaConstraints.audio.optional=w}if(f.mediaConstraints.video&&f.mediaConstraints.video.optional&&f.mediaConstraints.video.optional.length){var w=[];f.mediaConstraints.video.optional.forEach(function(a){"undefined"==typeof a.bandwidth&&w.push(a)}),f.mediaConstraints.video.optional=w}}f.getExtraData=function(a){if(!a)throw"remoteUserId is required.";return f.peers[a]?f.peers[a].extra:{}},d.autoOpenOrJoin&&f.openOrJoin(f.sessionid),f.onUserIdAlreadyTaken=function(a,b){f.enableLogs&&console.warn("Userid already taken.",a,"Your new userid:",b),f.join(a)},f.trickleIce=!0,f.version="3.4.1"}function b(a,b){var c="";c+="?userid="+a.userid,c+="&msgEvent="+a.socketMessageEvent,c+="&socketCustomEvent="+a.socketCustomEvent,a.enableScalableBroadcast&&(c+="&enableScalableBroadcast=true",c+="&maxRelayLimitPerUser="+(a.maxRelayLimitPerUser||2)),a.socketCustomParameters&&(c+=a.socketCustomParameters);try{io.sockets={}}catch(a){}try{a.socket=io((a.socketURL||"/")+c)}catch(b){a.socket=io.connect((a.socketURL||"/")+c,a.socketOptions)}a.socket.isIO=!0;var d=a.multiPeersHandler;a.socket.on("refreshPublicModerators",function(){console.log("receivedrpm"),rtcEvent("rpm")}),a.socket.on("extra-data-updated",function(b,c){a.peers[b]&&(a.peers[b].extra=c,a.onExtraDataUpdated({userid:b,extra:c}))}),a.socket.on(a.socketMessageEvent,function(b){if(b.remoteUserId==a.userid){if(a.peers[b.sender]&&a.peers[b.sender].extra!=b.message.extra&&(a.peers[b.sender].extra=b.extra,a.onExtraDataUpdated({userid:b.sender,extra:b.extra})),b.message.streamSyncNeeded&&a.peers[b.sender]){var c=a.streamEvents[b.message.streamid];if(!c||!c.stream)return;var e=b.message.action;if("ended"===e||"inactive"===e||"stream-removed"===e)return void a.onstreamended(c);var f="both"!=b.message.type?b.message.type:null;return void("function"==typeof c.stream[e]&&c.stream[e](f))}if("connectWithAllParticipants"===b.message)return a.broadcasters.indexOf(b.sender)===-1&&a.broadcasters.push(b.sender),void d.onNegotiationNeeded({allParticipants:a.getAllParticipants(b.sender)},b.sender);if("removeFromBroadcastersList"===b.message)return void(a.broadcasters.indexOf(b.sender)!==-1&&(delete a.broadcasters[a.broadcasters.indexOf(b.sender)],a.broadcasters=u(a.broadcasters)));if("dropPeerConnection"===b.message)return void a.deletePeer(b.sender);if(b.message.allParticipants)return b.message.allParticipants.indexOf(b.sender)===-1&&b.message.allParticipants.push(b.sender),void b.message.allParticipants.forEach(function(b){d[a.peers[b]?"renegotiatePeer":"createNewPeer"](b,{localPeerSdpConstraints:{OfferToReceiveAudio:a.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:a.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:{OfferToReceiveAudio:a.session.oneway?!!a.session.audio:a.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:a.session.oneway?!!a.session.video||!!a.session.screen:a.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:!!a.session.oneway||"one-way"===a.direction,isDataOnly:v(a.session)})});if(b.message.newParticipant){if(b.message.newParticipant==a.userid)return;if(a.peers[b.message.newParticipant])return;return void d.createNewPeer(b.message.newParticipant,b.message.userPreferences||{localPeerSdpConstraints:{OfferToReceiveAudio:a.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:a.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:{OfferToReceiveAudio:a.session.oneway?!!a.session.audio:a.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:a.session.oneway?!!a.session.video||!!a.session.screen:a.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:!!a.session.oneway||"one-way"===a.direction,isDataOnly:v(a.session)})}if((b.message.readyForOffer||b.message.addMeAsBroadcaster)&&a.addNewBroadcaster(b.sender),b.message.newParticipationRequest&&b.sender!==a.userid){a.peers[b.sender]&&a.deletePeer(b.sender);var g={extra:b.extra||{},localPeerSdpConstraints:b.message.remotePeerSdpConstraints||{OfferToReceiveAudio:a.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:a.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:b.message.localPeerSdpConstraints||{OfferToReceiveAudio:a.session.oneway?!!a.session.audio:a.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:a.session.oneway?!!a.session.video||!!a.session.screen:a.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:"undefined"!=typeof b.message.isOneWay?b.message.isOneWay:!!a.session.oneway||"one-way"===a.direction,isDataOnly:"undefined"!=typeof b.message.isDataOnly?b.message.isDataOnly:v(a.session),dontGetRemoteStream:"undefined"!=typeof b.message.isOneWay?b.message.isOneWay:!!a.session.oneway||"one-way"===a.direction,dontAttachLocalStream:!!b.message.dontGetRemoteStream,connectionDescription:b,successCallback:function(){("undefined"!=typeof b.message.isOneWay?b.message.isOneWay:!!a.session.oneway||"one-way"===a.direction)&&a.addNewBroadcaster(b.sender,g),(a.session.oneway||"one-way"===a.direction||v(a.session))&&a.addNewBroadcaster(b.sender,g)}};return void a.onNewParticipant(b.sender,g)}return b.message.shiftedModerationControl?void a.onShiftedModerationControl(b.sender,b.message.broadcasters):(b.message.changedUUID&&a.peers[b.message.oldUUID]&&(a.peers[b.message.newUUID]=a.peers[b.message.oldUUID],delete a.peers[b.message.oldUUID]),b.message.userLeft?(d.onUserLeft(b.sender),void(b.message.autoCloseEntireSession&&a.leave())):void d.addNegotiatedMessage(b.message,b.sender))}}),a.socket.on("user-left",function(b){onUserLeft(b),a.onUserStatusChanged({userid:b,status:"offline",extra:a.peers[b]?a.peers[b].extra||{}:{}}),a.onleave({userid:b,extra:{}})});var e=!1;a.socket.resetProps=function(){e=!1},a.socket.on("connect",function(){return e?void conslog("socket.on connect, already connected"):(e=!0,a.enableLogs&&console.info("socket.io connection is opened."),void setTimeout(function(){a.socket.emit("extra-data-updated",a.extra),b&&b(a.socket)},1e3))}),a.socket.on("disconnect",function(){a.enableLogs&&(console.warn("socket.io connection is closed"),conslog("socket.on disconnect"))}),a.socket.on("join-with-password",function(b){a.onJoinWithPassword(b)}),a.socket.on("invalid-password",function(b,c){a.onInvalidPassword(b,c)}),a.socket.on("password-max-tries-over",function(b){a.onPasswordMaxTriesOver(b)}),a.socket.on("rpm",function(a){conslog("rpm")}),a.socket.on("user-disconnected",function(b){b!==a.userid&&(console.log("user "+b+" disconnected from the broadcast"),rtcEvent("useroffline",{uid:b}),a.onUserStatusChanged({userid:b,status:"offline",extra:a.peers[b]?a.peers[b].extra||{}:{}}),a.deletePeer(b))}),a.socket.on("user-connected",function(b){b!==a.userid&&(console.log("user "+b+" connected to the broadcast"),rtcEvent("useronline",{uid:b}),a.onUserStatusChanged({userid:b,status:"online",extra:a.peers[b]?a.peers[b].extra||{}:{}}))}),a.socket.on("closed-entire-session",function(b,c){a.leave(),a.onEntireSessionClosed({sessionid:b,userid:b,extra:c})}),a.socket.on("userid-already-taken",function(b,c){a.isInitiator=!1,a.userid=c,a.onUserIdAlreadyTaken(b,c)}),a.socket.on("logs",function(b){a.enableLogs&&console.debug("server-logs",b)}),a.socket.on("number-of-broadcast-viewers-updated",function(b){console.log("broadcast users changed"),a.onNumberOfBroadcastViewersUpdated(b)})}function c(a){function f(){a.fbr=new FileBufferReader,a.fbr.onProgress=function(b){a.onFileProgress(b)},a.fbr.onBegin=function(b){a.onFileStart(b)},a.fbr.onEnd=function(b){a.onFileEnd(b)}}var b=this,c=["getAllParticipants","getLength","selectFirst","streams","send","forEach"];a.peers={getLength:function(){var a=0;for(var b in this)c.indexOf(b)==-1&&a++;return a},selectFirst:function(){var a;for(var b in this)c.indexOf(b)==-1&&(a=this[b]);return a},getAllParticipants:function(a){var b=[];for(var d in this)c.indexOf(d)==-1&&d!=a&&b.push(d);return b},forEach:function(b){this.getAllParticipants().forEach(function(c){b(a.peers[c])})},send:function(c,d){var e=this;if(!w(c.size)&&!w(c.type))return void b.shareFile(c,d);if(!("text"===c.type||c instanceof ArrayBuffer||c instanceof DataView))return void ea.send({text:c,channel:this,connection:a,remoteUserId:d});if("text"===c.type&&(c=JSON.stringify(c)),d){var f=a.peers[d];if(f)return f.channels.length?void f.channels.forEach(function(a){a.send(c)}):(a.peers[d].createDataChannel(),a.renegotiate(d),void setTimeout(function(){e.send(c,d)},3e3))}this.getAllParticipants().forEach(function(b){return e[b].channels.length?void e[b].channels.forEach(function(a){a.send(c)}):(a.peers[b].createDataChannel(),a.renegotiate(b),void setTimeout(function(){e[b].channels.forEach(function(a){a.send(c)})},3e3))})}},this.uuid=a.userid,this.getLocalConfig=function(c,d,e){return e||(e={}),{streamsToShare:e.streamsToShare||{},rtcMultiConnection:a,connectionDescription:e.connectionDescription,userid:d,localPeerSdpConstraints:e.localPeerSdpConstraints,remotePeerSdpConstraints:e.remotePeerSdpConstraints,dontGetRemoteStream:!!e.dontGetRemoteStream,dontAttachLocalStream:!!e.dontAttachLocalStream,renegotiatingPeer:!!e.renegotiatingPeer,peerRef:e.peerRef,channels:e.channels||[],onLocalSdp:function(a){b.onNegotiationNeeded(a,d)},onLocalCandidate:function(c){c=K.processCandidates(a,c),c&&b.onNegotiationNeeded(c,d)},remoteSdp:c,onDataChannelMessage:function(c){if(!a.fbr&&a.enableFileSharing&&f(),"string"==typeof c||!a.enableFileSharing)return void b.onDataChannelMessage(c,d);var e=this;return c instanceof ArrayBuffer||c instanceof DataView?void a.fbr.convertToObject(c,function(a){e.onDataChannelMessage(a)}):c.readyForNextChunk?void a.fbr.getNextChunk(c,function(b,c){a.peers[d].channels.forEach(function(a){a.send(b)})},d):c.chunkMissing?void a.fbr.chunkMissing(c):void a.fbr.addChunk(c,function(b){a.peers[d].peer.channel.send(b)})},onDataChannelError:function(a){b.onDataChannelError(a,d)},onDataChannelOpened:function(a){b.onDataChannelOpened(a,d)},onDataChannelClosed:function(a){b.onDataChannelClosed(a,d)},onRemoteStream:function(c){if(a.peers[d].streams.push(c),j&&window.PluginRTC){var e=document.createElement("video"),f=a.videosContainer;return f.insertBefore(e,f.firstChild),void setTimeout(function(){window.PluginRTC.attachMediaStream(e,c)},3e3)}b.onGettingRemoteMedia(c,d)},onRemoteStreamRemoved:function(a){b.onRemovingRemoteMedia(a,d);
},onPeerStateChanged:function(a){b.onPeerStateChanged(a),"new"===a.iceConnectionState&&b.onNegotiationStarted(d,a),"connected"===a.iceConnectionState&&b.onNegotiationCompleted(d,a),a.iceConnectionState.search(/closed|failed/gi)!==-1&&(b.onUserLeft(d),b.disconnectWith(d))}}},this.createNewPeer=function(b,c){if(!(a.maxParticipantsAllowed<=a.getAllParticipants().length)){if(c=c||{},a.isInitiator&&a.session.audio&&"two-way"===a.session.audio&&!c.streamsToShare&&(c.isOneWay=!1,c.isDataOnly=!1,c.session=a.session),!c.isOneWay&&!c.isDataOnly)return c.isOneWay=!0,void this.onNegotiationNeeded({enableMedia:!0,userPreferences:c},b);c=a.setUserPreferences(c,b);var d=this.getLocalConfig(null,b,c);a.peers[b]=new I(d)}},this.createAnsweringPeer=function(b,c,d){d=a.setUserPreferences(d||{},c);var e=this.getLocalConfig(b,c,d);a.peers[c]=new I(e)},this.renegotiatePeer=function(b,c,d){if(!a.peers[b])return void(a.enableLogs&&console.error("This peer ("+b+") does not exists. Renegotiation skipped."));c||(c={}),c.renegotiatingPeer=!0,c.peerRef=a.peers[b].peer,c.channels=a.peers[b].channels;var e=this.getLocalConfig(d,b,c);a.peers[b]=new I(e)},this.replaceTrack=function(b,c,d){if(!a.peers[c])throw"This peer ("+c+") does not exists.";var e=a.peers[c].peer;return e.getSenders&&"function"==typeof e.getSenders&&e.getSenders().length?void e.getSenders().forEach(function(e){d&&e.track instanceof VideoStreamTrack&&(a.peers[c].peer.lastVideoTrack=e.track,e.replaceTrack(b)),!d&&e.track instanceof AudioStreamTrack&&(a.peers[c].peer.lastAudioTrack=e.track,e.replaceTrack(b))}):(console.warn("RTPSender.replaceTrack is NOT supported."),void this.renegotiatePeer(c))},this.onNegotiationNeeded=function(a,b){},this.addNegotiatedMessage=function(c,e){if(c.type&&c.sdp)return"answer"==c.type&&a.peers[e]&&a.peers[e].addRemoteSdp(c),"offer"==c.type&&(c.renegotiatingPeer?this.renegotiatePeer(e,null,c):this.createAnsweringPeer(c,e)),void(a.enableLogs&&console.log("Remote peer's sdp:",c.sdp));if(c.candidate)return a.peers[e]&&a.peers[e].addRemoteCandidate(c),void(a.enableLogs&&console.log("Remote peer's candidate pairs:",c.candidate));if(c.enableMedia&&(a.attachStreams.length||a.dontCaptureUserMedia)){var f={};return a.attachStreams.forEach(function(a){f[a.streamid]={isAudio:!!a.isAudio,isVideo:!!a.isVideo,isScreen:!!a.isScreen}}),c.userPreferences.streamsToShare=f,void b.onNegotiationNeeded({readyForOffer:!0,userPreferences:c.userPreferences},e)}c.readyForOffer&&a.onReadyForOffer(e,c.userPreferences)},this.connectNewParticipantWithAllBroadcasters=function(c,d,e){if(!a.socket.isIO&&(e=(e||"").split("|-,-|"),e.length)){var f,g=[];e.forEach(function(a){a=(a||"").replace(/ /g,""),a.length&&(f?g.push(a):f=a)}),f&&(b.onNegotiationNeeded({newParticipant:c,userPreferences:d||!1},f),g.length&&setTimeout(function(){b.connectNewParticipantWithAllBroadcasters(c,d,g.join("|-,-|"))},3e3))}},this.onGettingRemoteMedia=function(a,b){},this.onRemovingRemoteMedia=function(a,b){},this.onGettingLocalMedia=function(a){},this.onLocalMediaError=function(b,c){a.onMediaError(b,c)},this.shareFile=function(b,c){if(!a.enableFileSharing)throw'"connection.enableFileSharing" is false.';f(),a.fbr.readAsArrayBuffer(b,function(b){var d=a.getAllParticipants();c&&(d=[c]),d.forEach(function(c){a.fbr.getNextChunk(b,function(b){a.peers[c].channels.forEach(function(a){a.send(b)})},c)})},{userid:a.userid,chunkSize:e?15e3:a.chunkSize||0})};var g=new da(a);this.onDataChannelMessage=function(b,c){g.receive(JSON.parse(b),c,a.peers[c]?a.peers[c].extra:{})},this.onDataChannelClosed=function(b,c){b.userid=c,b.extra=a.peers[c]?a.peers[c].extra:{},a.onclose(b)},this.onDataChannelError=function(b,c){b.userid=c,event.extra=a.peers[c]?a.peers[c].extra:{},a.onerror(b)},this.onDataChannelOpened=function(b,c){return a.peers[c].channels.length?void(a.peers[c].channels=[b]):(a.peers[c].channels.push(b),void a.onopen({userid:c,extra:a.peers[c]?a.peers[c].extra:{},channel:b}))},this.onPeerStateChanged=function(b){a.onPeerStateChanged(b)},this.onNegotiationStarted=function(a,b){},this.onNegotiationCompleted=function(a,b){},this.getRemoteStreams=function(b){return b=b||a.peers.getAllParticipants()[0],a.peers[b]?a.peers[b].streams:[]},this.isPluginRTC=a.isPluginRTC=j}function o(a,b,c){if("undefined"!=typeof CustomEvent){var d={arguments:c,__exposedProps__:c},e=new CustomEvent(b,d);a.dispatchEvent(e)}}function p(a,b){if(!a||!b)throw"Both arguments are required.";if(a.onspeaking&&a.onsilence){if("undefined"==typeof hark)throw"hark.js not found.";hark(b.stream,{onspeaking:function(){a.onspeaking(b)},onsilence:function(){a.onsilence(b)},onvolumechange:function(c,d){a.onvolumechange&&a.onvolumechange(merge({volume:c,threshold:d},b))}})}}function q(a,b){b.stream&&b.stream&&b.stream.addEventListener&&(b.stream.addEventListener("mute",function(c){c=a.streamEvents[b.streamid],c.session={audio:"audio"===c.muteType,video:"video"===c.muteType},a.onmute(c)},!1),b.stream.addEventListener("unmute",function(c){c=a.streamEvents[b.streamid],c.session={audio:"audio"===c.unmuteType,video:"video"===c.unmuteType},a.onunmute(c)},!1))}function r(){if(window.crypto&&window.crypto.getRandomValues&&navigator.userAgent.indexOf("Safari")===-1){for(var a=window.crypto.getRandomValues(new Uint32Array(3)),b="",c=0,d=a.length;c<d;c++)b+=a[c].toString(36);return b}return(Math.random()*(new Date).getTime()).toString(36).replace(/\./g,"")}function s(a,b,c){var d=!1;a.getVideoTracks&&!a.getVideoTracks().length&&(d=!0);var f=document.createElement(d?"audio":"video");if(j&&window.PluginRTC)return c.videosContainer.insertBefore(f,c.videosContainer.firstChild),void setTimeout(function(){window.PluginRTC.attachMediaStream(f,a),b(f)},1e3);if(f[e?"mozSrcObject":"src"]=e?a:window.URL.createObjectURL(a),f.controls=!0,e){var g="ended";"oninactive"in a&&(g="inactive"),f.addEventListener(g,function(){if(T.remove(a.idInstance),"local"===a.type){V.onSyncNeeded(a.streamid,g),c.attachStreams.forEach(function(b,d){a.streamid===b.streamid&&delete c.attachStreams[d]});var b=[];c.attachStreams.forEach(function(a){a&&b.push(a)}),c.attachStreams=b;var d=c.streamEvents[a.streamid];if(d)return void c.onstreamended(d);this.parentNode&&this.parentNode.removeChild(this)}},!1)}f.play(),b(f)}function t(a,b){window.removeEventListener(a,b),window.addEventListener(a,b,!1)}function u(a){var b=[];return a.forEach(function(a){a&&b.push(a)}),b}function v(a){return!a.audio&&!a.video&&!a.screen&&a.data}function w(a){return"undefined"==typeof a}function x(a){return"string"==typeof a}function z(a,b){return(!a.session.audio||"two-way"!==a.session.audio)&&(!(!e||b===!1)||!(!g||l<50)&&(typeof b===!0||!("undefined"!=typeof b||!a.session.audio||!a.session.screen||a.session.video)&&(b=!0,!0)))}function A(a){return!!e||!!g&&{mandatory:{chromeMediaSource:a.mandatory.chromeMediaSource,chromeMediaSourceId:a.mandatory.chromeMediaSourceId}}}function B(){if("iOS"===DetectRTC.osName&&"undefined"!=typeof cordova&&"undefined"!=typeof cordova.plugins&&"undefined"!=typeof cordova.plugins.iosrtc){var a=cordova.plugins.iosrtc;window.webkitRTCPeerConnection=a.RTCPeerConnection,window.RTCSessionDescription=a.RTCSessionDescription,window.RTCIceCandidate=a.RTCIceCandidate,window.MediaStream=a.MediaStream,window.MediaStreamTrack=a.MediaStreamTrack,navigator.getUserMedia=navigator.webkitGetUserMedia=a.getUserMedia,a.debug.enable("iosrtc*"),a.registerGlobals()}}function D(a){var b,c={OfferToReceiveAudio:!!a.OfferToReceiveAudio,OfferToReceiveVideo:!!a.OfferToReceiveVideo};return b={mandatory:c,optional:[{VoiceActivityDetection:!1}]},navigator.mozGetUserMedia&&n>34&&(b={OfferToReceiveAudio:!!a.OfferToReceiveAudio,OfferToReceiveVideo:!!a.OfferToReceiveVideo}),b}function I(a){function j(){return f.getLocalStreams()}function q(b){b.binaryType="arraybuffer",b.onmessage=function(b){a.onDataChannelMessage(b.data)},b.onopen=function(){a.onDataChannelOpened(b)},b.onerror=function(b){a.onDataChannelError(b)},b.onclose=function(b){a.onDataChannelClosed(b)},b.internalSend=b.send,b.send=function(a){"open"===b.readyState&&b.internalSend(a)},f.channel=b}function s(d){f[d](function(d){d.sdp=b.processSdp(d.sdp),f.setLocalDescription(d,function(){b.trickleIce&&a.onLocalSdp({type:d.type,sdp:d.sdp,remotePeerSdpConstraints:a.remotePeerSdpConstraints||!1,renegotiatingPeer:!!a.renegotiatingPeer||!1,connectionDescription:c.connectionDescription,dontGetRemoteStream:!!a.dontGetRemoteStream,extra:b?b.extra:{},streamsToShare:r,isFirefoxOffered:e})},function(a){b.enableLogs&&console.error("setLocalDescription error",a)})},function(a){b.enableLogs&&console.error("sdp-error",a)},C.sdpConstraints)}if(!E)throw"WebRTC 1.0 (RTCPeerConnection) API are NOT available in this browser.";var b=a.rtcMultiConnection;this.extra=a.remoteSdp?a.remoteSdp.extra:b.extra,this.userid=a.userid,this.streams=[],this.channels=a.channels||[],this.connectionDescription=a.connectionDescription;var c=this;a.remoteSdp&&(this.connectionDescription=a.remoteSdp.connectionDescription);var d={};C.sdpConstraints=D({OfferToReceiveAudio:!0,OfferToReceiveVideo:!0});var f,g=!!a.renegotiatingPeer;a.remoteSdp&&(g=!!a.remoteSdp.renegotiatingPeer);var h=[];if(b.attachStreams.forEach(function(a){a&&h.push(a)}),g)f=a.peerRef;else{var i="all";(b.candidates.turn||b.candidates.relay)&&(b.candidates.stun||b.candidates.reflexive||b.candidates.host||(i="relay")),f=new E(navigator.onLine?{iceServers:b.iceServers,iceTransports:i}:null,window.PluginRTC?null:b.optionalArgument)}f.onicecandidate=function(d){if(d.candidate)b.trickleIce&&a.onLocalCandidate({candidate:d.candidate.candidate,sdpMid:d.candidate.sdpMid,sdpMLineIndex:d.candidate.sdpMLineIndex});else if(!b.trickleIce){var g=f.localDescription;a.onLocalSdp({type:g.type,sdp:g.sdp,remotePeerSdpConstraints:a.remotePeerSdpConstraints||!1,renegotiatingPeer:!!a.renegotiatingPeer||!1,connectionDescription:c.connectionDescription,dontGetRemoteStream:!!a.dontGetRemoteStream,extra:b?b.extra:{},streamsToShare:r,isFirefoxOffered:e})}};var k=!e;a.remoteSdp&&a.remoteSdp.remotePeerSdpConstraints&&a.remoteSdp.remotePeerSdpConstraints.isFirefoxOffered&&(k=!0),h.forEach(function(c){a.remoteSdp&&a.remoteSdp.remotePeerSdpConstraints&&a.remoteSdp.remotePeerSdpConstraints.dontGetRemoteStream||a.dontAttachLocalStream||(c=b.beforeAddingStream(c),c&&(j().forEach&&j().forEach(function(a){c&&a.id==c.id&&(c=null)}),c&&f.addStream(c)))}),f.oniceconnectionstatechange=f.onsignalingstatechange=function(){var d=c.extra;b.peers[c.userid]&&(d=b.peers[c.userid].extra||d),f&&a.onPeerStateChanged({iceConnectionState:f.iceConnectionState,iceGatheringState:f.iceGatheringState,signalingState:f.signalingState,extra:d,userid:c.userid})};var l={OfferToReceiveAudio:!!h.length,OfferToReceiveVideo:!!h.length};a.localPeerSdpConstraints&&(l=a.localPeerSdpConstraints),C.sdpConstraints=D(l);var n,m="addstream";f.addEventListener(m,function(c){if(c.streams&&c.streams.length&&!c.stream){if(!n)return void(n=new y);if(c.streams.forEach(function(a){a.getVideoTracks().length&&n.addTrack(a.getVideoTracks()[0]),a.getAudioTracks().length&&n.addTrack(a.getAudioTracks()[0])}),c.stream=n,b.session.audio&&b.session.video&&(!n.getVideoTracks().length||!n.getAudioTracks().length))return;n=null}var f={};a.remoteSdp&&a.remoteSdp.streamsToShare?f=a.remoteSdp.streamsToShare:a.streamsToShare&&(f=a.streamsToShare);var g=f[c.stream.id];g&&(c.stream.isAudio=g.isAudio,c.stream.isVideo=g.isVideo,c.stream.isScreen=g.isScreen),c.stream.streamid=c.stream.id,c.stream.stop||(c.stream.stop=function(){if(e){var a="ended";"oninactive"in c.stream&&(a="inactive"),o(c.stream,a)}}),d[c.stream.id]=c.stream,a.onRemoteStream(c.stream)},!1),f.onremovestream=function(b){b.stream.streamid=b.stream.id,d[b.stream.id]&&delete d[b.stream.id],a.onRemoteStreamRemoved(b.stream)},this.addRemoteCandidate=function(a){var b=new G(a);f.addIceCandidate(b)},this.addRemoteSdp=function(a,c){a.sdp=b.processSdp(a.sdp),f.setRemoteDescription(new F(a),c||function(){},function(c){b.enableLogs&&console.error(JSON.stringify(c,null,"\t"),"\n",a.type,a.sdp)})};var p=!0;a.remoteSdp&&(p=!1),this.createDataChannel=function(){var a=f.createDataChannel("sctp",{});q(a)},b.session.data!==!0||g||(p?this.createDataChannel():f.ondatachannel=function(a){var b=a.channel;q(b)}),a.remoteSdp&&(a.remoteSdp.remotePeerSdpConstraints&&(l=a.remoteSdp.remotePeerSdpConstraints),C.sdpConstraints=D(l),this.addRemoteSdp(a.remoteSdp,function(){s("createAnswer")})),"two-way"!=b.session.audio&&"two-way"!=b.session.video&&"two-way"!=b.session.screen||(C.sdpConstraints=D({OfferToReceiveAudio:"two-way"==b.session.audio||a.remoteSdp&&a.remoteSdp.remotePeerSdpConstraints&&a.remoteSdp.remotePeerSdpConstraints.OfferToReceiveAudio,OfferToReceiveVideo:"two-way"==b.session.video||"two-way"==b.session.screen||a.remoteSdp&&a.remoteSdp.remotePeerSdpConstraints&&a.remoteSdp.remotePeerSdpConstraints.OfferToReceiveAudio}));var r={};j().forEach&&j().forEach(function(a){r[a.streamid]={isAudio:!!a.isAudio,isVideo:!!a.isVideo,isScreen:!!a.isScreen}}),p&&s("createOffer"),f.nativeClose=f.close,f.close=function(){if(f){try{f.iceConnectionState.search(/closed|failed/gi)===-1&&f.getRemoteStreams().forEach(function(a){a.stop()}),f.nativeClose()}catch(a){}f=null,c.peer=null}},this.peer=f}function N(a,b){if(!M){if(!b)return N(a,!0);M=!0;var c=document.createElement("iframe");c.onload=function(){function b(c){c.data&&c.data.iceServers&&(a(c.data.iceServers),window.removeEventListener("message",b))}c.isLoaded=!0,t("message",b),c.contentWindow.postMessage("get-ice-servers","*")},c.src="https://cdn.webrtc-experiment.com/getIceServers/",c.style.display="none",(document.body||document.documentElement).appendChild(c)}}function O(a){var b="urls";j&&(b="url");var c={};return c[b]=a,c}function P(a,b,c){var d="urls";j&&(d="url");var e={username:b,credential:c};return e[d]=a,e}function Q(){var a=[];return window.RMCExternalIceServers.forEach(function(b){b.urls||(b.urls=b.url),b.urls.search("stun|stuns")!==-1&&a.push(O(b.urls)),b.urls.search("turn|turns")!==-1&&a.push(P(b.urls,b.username,b.credential))}),a}function S(a,b){a.mandatory&&a.mandatory.chromeMediaSource?b.isScreen=!0:a.mozMediaSource||a.mediaSource?b.isScreen=!0:a.video?b.isVideo=!0:a.audio&&(b.isAudio=!0)}function U(a){function c(c,d){S(a.localMediaConstraints,c),a.onGettingLocalMedia(c,d);var e="ended";"oninactive"in c&&(e="inactive"),c.addEventListener(e,function(){delete T.streams[b],T.mutex=!1,T.queueRequests.indexOf(a)&&(delete T.queueRequests[T.queueRequests.indexOf(a)],T.queueRequests=u(T.queueRequests))},!1),T.streams[b]={stream:c},T.mutex=!1,T.queueRequests.length&&U(T.queueRequests.shift())}if(T.mutex===!0)return void T.queueRequests.push(a);T.mutex=!0;var b=JSON.stringify(a.localMediaConstraints);if(T.streams[b])c(T.streams[b].stream,!0);else{if(j&&window.PluginRTC){document.createElement("video");return void window.PluginRTC.getUserMedia({audio:!0,video:!0},function(a){a.streamid=a.id||r(),c(a)},function(a){})}var e=!!/BB10|BlackBerry/i.test(navigator.userAgent||"");if(e||"undefined"==typeof navigator.mediaDevices||"function"!=typeof navigator.mediaDevices.getUserMedia)return navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,void navigator.getUserMedia(a.localMediaConstraints,function(a){a.streamid=a.streamid||a.id||r(),a.idInstance=b,c(a)},function(b){a.onLocalMediaError(b,a.localMediaConstraints)});navigator.mediaDevices.getUserMedia(a.localMediaConstraints).then(function(a){a.streamid=a.streamid||a.id||r(),a.idInstance=b,c(a)}).catch(function(b){a.onLocalMediaError(b,a.localMediaConstraints)})}}function W(a){if("PermissionDeniedError"==a){if(X="PermissionDeniedError",Z)return Z("PermissionDeniedError");throw new Error("PermissionDeniedError: User rejected to share his screen.")}"rtcmulticonnection-extension-loaded"==a&&(X="desktop"),a.sourceId&&Z&&Z(Y=a.sourceId)}function $(a){if(a){if(e)return _(a);if("desktop"==X)return a(!0);window.postMessage("are-you-there","*"),setTimeout(function(){a("screen"==X?!1:!0)},2e3)}}function _(a){function c(d){var e=d.data;e&&"undefined"!=typeof e.isScreenCapturingEnabled&&(b=!0,a(e.isScreenCapturingEnabled===!0?!0:!1),window.removeEventListener("message",c,!1))}if(a){if(!e)return $(a);var b=!1;window.addEventListener("message",c,!1),window.postMessage({checkIfScreenCapturingEnabled:!0,domains:[document.domain]},"*"),setTimeout(function(){b||a(!0)},2e3)}}function aa(a,b){if(!a)throw'"callback" parameter is mandatory.';return Y?(a(Y),void(Y=null)):(Z=a,b?void window.postMessage("audio-plus-tab","*"):void window.postMessage("get-sourceId","*"))}function ba(a,b){if(2!=arguments.length&&(b=a,a=window.RMCExtensionID||"ajhifddimkapgcifgcodmmfdlknahffk"),e)return b("not-chrome");var c=document.createElement("img");c.src="chrome-extension://"+a+"/icon.png",c.onload=function(){X="screen",window.postMessage("are-you-there","*"),setTimeout(function(){b("screen"==X?a==a?"installed-enabled":"installed-disabled":"installed-enabled")},2e3)},c.onerror=function(){b("not-installed")}}function ca(a,b){var c={mozMediaSource:"window",mediaSource:"window",width:29999,height:8640};return e?a(null,c):void $(function(c){var d={mandatory:{chromeMediaSource:X,maxWidth:29999,maxHeight:8640,minFrameRate:30,maxFrameRate:128,minAspectRatio:1.77},optional:[]};return"desktop"!=X||Y?("desktop"==X&&(d.mandatory.chromeMediaSourceId=Y),void a(null,d)):void aa(function(){d.mandatory.chromeMediaSourceId=Y,a("PermissionDeniedError"==Y?Y:null,d),Y=null},b)})}function da(a){function c(c,d,e){var f=c.uuid;if(b[f]||(b[f]=[]),b[f].push(c.message),c.last){var g=b[f].join("");c.isobject&&(g=JSON.parse(g));var h=(new Date).getTime(),i=h-c.sendingTime,j={data:g,userid:d,extra:e,latency:i};a.autoTranslateText?(j.original=j.data,a.Translator.TranslateText(j.data,function(b){j.data=b,a.onmessage(j)})):a.onmessage(j),delete b[f]}}var b={};return{receive:c}}var d=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,e="undefined"!=typeof window.InstallTrigger,f=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,g=!!window.chrome&&!d,h=!!document.documentMode,i=!!navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i);"undefined"!=typeof cordova&&(i=!0,g=!0),navigator&&navigator.userAgent&&navigator.userAgent.indexOf("Crosswalk")!==-1&&(i=!0,g=!0);var j=!i&&(f||h);j&&"undefined"!=typeof URL&&(URL.createObjectURL=function(){});var l=(!!(window.process&&"object"==typeof window.process&&window.process.versions&&window.process.versions["node-webkit"]),50),m=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);g&&m&&m[2]&&(l=parseInt(m[2],10));var n=50;m=navigator.userAgent.match(/Firefox\/(.*)/),e&&m&&m[1]&&(n=parseInt(m[1],10)),window.addEventListener||(window.addEventListener=function(a,b,c){a.attachEvent&&a.attachEvent("on"+b,c)}),window.attachEventListener=function(a,b,c,d){a.addEventListener(b,c,d)};var y=window.MediaStream;"undefined"==typeof y&&"undefined"!=typeof webkitMediaStream&&(y=webkitMediaStream),"undefined"!=typeof y&&("getVideoTracks"in y.prototype||(y.prototype.getVideoTracks=function(){if(!this.getTracks)return[];var a=[];return this.getTracks.forEach(function(b){b.kind.toString().indexOf("video")!==-1&&a.push(b)}),a},y.prototype.getAudioTracks=function(){if(!this.getTracks)return[];var a=[];return this.getTracks.forEach(function(b){b.kind.toString().indexOf("audio")!==-1&&a.push(b)}),a}),"stop"in y.prototype||(y.prototype.stop=function(){this.getAudioTracks().forEach(function(a){a.stop&&a.stop()}),this.getVideoTracks().forEach(function(a){a.stop&&a.stop()})})),function(){"use strict";function j(){var m,n,o,c=(b.appVersion,b.userAgent),j=b.appName,k=""+parseFloat(b.appVersion),l=parseInt(b.appVersion,10);if(e){j="Opera";try{k=b.userAgent.split("OPR/")[1].split(" ")[0],l=k.split(".")[0]}catch(a){k="0.0.0.0",l=0}}else i?(n=c.indexOf("MSIE"),j="IE",k=c.substring(n+5)):h?(n=c.indexOf("Chrome"),j="Chrome",k=c.substring(n+7)):g?(n=c.indexOf("Safari"),j="Safari",k=c.substring(n+7),(n=c.indexOf("Version"))!==-1&&(k=c.substring(n+8))):f?(n=c.indexOf("Firefox"),j="Firefox",k=c.substring(n+8)):(m=c.lastIndexOf(" ")+1)<(n=c.lastIndexOf("/"))&&(j=c.substring(m,n),k=c.substring(n+1),j.toLowerCase()===j.toUpperCase()&&(j=b.appName));return d&&(j="Edge",k=parseInt(b.userAgent.match(/Edge\/(\d+).(\d+)$/)[2],10).toString()),(o=k.indexOf(";"))!==-1&&(k=k.substring(0,o)),(o=k.indexOf(" "))!==-1&&(k=k.substring(0,o)),l=parseInt(""+k,10),isNaN(l)&&(k=""+parseFloat(b.appVersion),l=parseInt(b.appVersion,10)),{fullVersion:k,version:l,name:j,isPrivateBrowsing:!1}}function k(a,b){var c=0,d=50,f=!1,g=window.setInterval(function(){a()&&(window.clearInterval(g),b(f)),c++>d&&(window.clearInterval(g),f=!0,b(f))},10)}function l(a){var b=a.toLowerCase();if(0===b.indexOf("msie")&&0===b.indexOf("trident"))return!1;var c=/(?:msie|rv:)\s?([\d\.]+)/.exec(b);return!!(c&&parseInt(c[1],10)>=10)}function m(a){var b;if(window.webkitRequestFileSystem)window.webkitRequestFileSystem(window.TEMPORARY,1,function(){b=!1},function(a){b=!0});else if(window.indexedDB&&/Firefox/.test(window.navigator.userAgent)){var c;try{c=window.indexedDB.open("test"),c.onerror=function(){return!0}}catch(a){b=!0}"undefined"==typeof b&&k(function(){return"done"===c.readyState},function(d){d||(b=!c.result)})}else if(l(window.navigator.userAgent)){b=!1;try{window.indexedDB||(b=!0)}catch(a){b=!0}}else if(window.localStorage&&/Safari/.test(window.navigator.userAgent)){try{window.localStorage.setItem("test",1)}catch(a){b=!0}"undefined"==typeof b&&(b=!1,window.localStorage.removeItem("test"))}k(function(){return"undefined"!=typeof b},function(d){a(b)})}function o(){var a="-",c=b.appVersion,d=b.userAgent,e=a,f=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(var g in f){var h=f[g];if(h.r.test(d)){e=h.s;break}}var i=a;switch(/Windows/.test(e)&&(/Windows (.*)/.test(e)&&(i=/Windows (.*)/.exec(e)[1]),e="Windows"),e){case"Mac OS X":/Mac OS X (10[\.\_\d]+)/.test(d)&&(i=/Mac OS X (10[\.\_\d]+)/.exec(d)[1]);break;case"Android":/Android ([\.\_\d]+)/.test(d)&&(i=/Android ([\.\_\d]+)/.exec(d)[1]);break;case"iOS":/OS (\d+)_(\d+)_?(\d+)?/.test(d)&&(i=/OS (\d+)_(\d+)_?(\d+)?/.exec(c),i=i[1]+"."+i[2]+"."+(0|i[3]))}return{osName:e,osVersion:i}}function u(a){I.isWebRTCSupported&&(I.isORTCSupported||v(function(b){a(b.match(/^(192\.168\.|169\.254\.|10\.|172\.(1[6-9]|2\d|3[01]))/)?"Local: "+b:"Public: "+b)}))}function v(a){function j(c){var d=/([0-9]{1,3}(\.[0-9]{1,3}){3})/,e=d.exec(c);if(!e)return void console.warn("Could not match IP address in",c);var f=e[1];void 0===b[f]&&a(f),b[f]=!0}var b={},c=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,d=!!window.webkitRTCPeerConnection;if(!c){var e=document.getElementById("iframe");if(!e)throw"NOTE: you need to have an iframe in the page right above the script tag.";var f=e.contentWindow;c=f.RTCPeerConnection||f.mozRTCPeerConnection||f.webkitRTCPeerConnection,d=!!f.webkitRTCPeerConnection}if(c){var h,g={optional:[{RtpDataChannels:!0}]};d&&(h={iceServers:[{urls:"stun:stun.services.mozilla.com"}]},"undefined"!=typeof I&&I.browser.isFirefox&&I.browser.version<=38&&(h[0]={url:h[0].urls}));var i=new c(h,g);i.onicecandidate=function(a){a.candidate&&j(a.candidate.candidate)},i.createDataChannel(""),i.createOffer(function(a){i.setLocalDescription(a,function(){},function(){})},function(){}),setTimeout(function(){var a=i.localDescription.sdp.split("\n");a.forEach(function(a){0===a.indexOf("a=candidate:")&&j(a)})},1e3)}}function G(a){return A?(!b.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(b.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!b.enumerateDevices&&b.enumerateDevices&&(b.enumerateDevices=b.enumerateDevices.bind(b)),b.enumerateDevices?(w=[],x=[],y=[],z=[],void b.enumerateDevices(function(b){b.forEach(function(a){var b={};for(var c in a)b[c]=a[c];"audio"===b.kind&&(b.kind="audioinput"),"video"===b.kind&&(b.kind="videoinput");var d;w.forEach(function(a){a.id===b.id&&a.kind===b.kind&&(d=!0)}),d||(b.deviceId||(b.deviceId=b.id),b.id||(b.id=b.deviceId),b.label?("videoinput"!==b.kind||F||(F=!0),"audioinput"!==b.kind||E||(E=!0)):(b.label="Please invoke getUserMedia once.","https:"!==location.protocol&&document.domain.search&&document.domain.search(/localhost|127.0./g)===-1&&(b.label="HTTPs is required to get label of this "+b.kind+" device.")),"audioinput"===b.kind&&(B=!0,x.indexOf(b)===-1&&x.push(b)),"audiooutput"===b.kind&&(C=!0,y.indexOf(b)===-1&&y.push(b)),"videoinput"===b.kind&&(D=!0,z.indexOf(b)===-1&&z.push(b)),w.indexOf(b)===-1&&w.push(b))}),"undefined"!=typeof I&&(I.MediaDevices=w,I.hasMicrophone=B,I.hasSpeakers=C,I.hasWebcam=D,I.isWebsiteHasWebcamPermissions=F,I.isWebsiteHasMicrophonePermissions=E,I.audioInputDevices=x,I.audioOutputDevices=y,I.videoInputDevices=z),a&&a()})):void(a&&a())):void(a&&a())}var a="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";!function(b){"undefined"==typeof window&&("undefined"==typeof window&&"undefined"!=typeof global?(global.navigator={userAgent:a,getUserMedia:function(){}},b.window=global):"undefined"==typeof window,"undefined"==typeof document&&(b.document={},document.createElement=document.captureStream=document.mozCaptureStream=function(){return{}}),"undefined"==typeof location&&(b.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(b.screen={width:0,height:0}))}("undefined"!=typeof global?global:window);var b=window.navigator;console.log("typeof navigator",typeof b),"undefined"!=typeof b?("undefined"!=typeof b.webkitGetUserMedia&&(b.getUserMedia=b.webkitGetUserMedia),"undefined"!=typeof b.mozGetUserMedia&&(b.getUserMedia=b.mozGetUserMedia)):b={getUserMedia:function(){},userAgent:a};var c=!!/Android|webOS|iPhone|iPad|iPod|BB10|BlackBerry|IEMobile|Opera Mini|Mobile|mobile/i.test(b.userAgent||""),d=!(b.userAgent.indexOf("Edge")===-1||!b.msSaveOrOpenBlob&&!b.msSaveBlob),e=!!window.opera||b.userAgent.indexOf(" OPR/")>=0,f="undefined"!=typeof window.InstallTrigger,g=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,h=!!window.chrome&&!e,i=!!document.documentMode&&!d,n={Android:function(){return b.userAgent.match(/Android/i)},BlackBerry:function(){return b.userAgent.match(/BlackBerry|BB10/i)},iOS:function(){return b.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return b.userAgent.match(/Opera Mini/i)},Windows:function(){return b.userAgent.match(/IEMobile/i)},any:function(){return n.Android()||n.BlackBerry()||n.iOS()||n.Opera()||n.Windows()},getOsName:function(){var a="Unknown OS";return n.Android()&&(a="Android"),n.BlackBerry()&&(a="BlackBerry"),n.iOS()&&(a="iOS"),n.Opera()&&(a="Opera Mini"),n.Windows()&&(a="Windows"),a}},p="Unknown OS",q="Unknown OS Version";if(n.any())p=n.getOsName();else{var r=o();p=r.osName,q=r.osVersion}var s=!1,t=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(a){!s&&a in document.createElement("canvas")&&(s=!0),!t&&a in document.createElement("video")&&(t=!0)});var w=[],x=[],y=[],z=[];b.mediaDevices&&b.mediaDevices.enumerateDevices&&(b.enumerateDevices=function(a){b.mediaDevices.enumerateDevices().then(a).catch(function(){a([])})});var A=!1;"undefined"!=typeof H&&"getSources"in H?A=!0:b.mediaDevices&&b.mediaDevices.enumerateDevices&&(A=!0);var B=!1,C=!1,D=!1,E=!1,F=!1;G();var I=window.DetectRTC||{};I.browser=j(),m(function(a){I.browser.isPrivateBrowsing=!!a}),I.browser["is"+I.browser.name]=!0;var K=(!!(window.process&&"object"==typeof window.process&&window.process.versions&&window.process.versions["node-webkit"]),!1);["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach(function(a){K||a in window&&(K=!0)}),I.isWebRTCSupported=K,I.isORTCSupported="undefined"!=typeof RTCIceGatherer;var L=!1;I.browser.isChrome&&I.browser.version>=35?L=!0:I.browser.isFirefox&&I.browser.version>=34&&(L=!0),"https:"!==location.protocol&&(L=!1),I.isScreenCapturingSupported=L;var M={isSupported:!1,isCreateMediaStreamSourceSupported:!1};["AudioContext","webkitAudioContext","mozAudioContext","msAudioContext"].forEach(function(a){M.isSupported||a in window&&(M.isSupported=!0,"createMediaStreamSource"in window[a].prototype&&(M.isCreateMediaStreamSourceSupported=!0))}),I.isAudioContextSupported=M.isSupported,I.isCreateMediaStreamSourceSupported=M.isCreateMediaStreamSourceSupported;var N=!1;I.browser.isChrome&&I.browser.version>31&&(N=!0),I.isRtpDataChannelsSupported=N;var O=!1;I.browser.isFirefox&&I.browser.version>28?O=!0:I.browser.isChrome&&I.browser.version>25?O=!0:I.browser.isOpera&&I.browser.version>=11&&(O=!0),I.isSctpDataChannelsSupported=O,I.isMobileDevice=c;var P=!1;b.getUserMedia?P=!0:b.mediaDevices&&b.mediaDevices.getUserMedia&&(P=!0),I.browser.isChrome&&I.browser.version>=46&&"https:"!==location.protocol&&(I.isGetUserMediaSupported="Requires HTTPs"),I.isGetUserMediaSupported=P,I.osName=p,I.osVersion=q;var Q="";if(screen.width){var R=screen.width?screen.width:"",S=screen.height?screen.height:"";Q+=""+R+" x "+S}I.displayResolution=Q,I.isCanvasSupportsStreamCapturing=s,I.isVideoSupportsStreamCapturing=t,I.DetectLocalIPAddress=u,I.isWebSocketsSupported="WebSocket"in window&&2===window.WebSocket.CLOSING,I.isWebSocketsBlocked=!I.isWebSocketsSupported,I.checkWebSocketsSupport=function(a){a=a||function(){};try{var b=new WebSocket("wss://echo.websocket.org:443/");b.onopen=function(){I.isWebSocketsBlocked=!1,a(),b.close(),b=null},b.onerror=function(){I.isWebSocketsBlocked=!0,a()}}catch(b){I.isWebSocketsBlocked=!0,a()}},I.load=function(a){a=a||function(){},G(a)},I.MediaDevices=w,I.hasMicrophone=B,I.hasSpeakers=C,I.hasWebcam=D,I.isWebsiteHasWebcamPermissions=F,I.isWebsiteHasMicrophonePermissions=E,I.audioInputDevices=x,I.audioOutputDevices=y,I.videoInputDevices=z;var T=!1;"setSinkId"in document.createElement("video")&&(T=!0),I.isSetSinkIdSupported=T;var U=!1;I.browser.isFirefox&&"undefined"!=typeof mozRTCPeerConnection?"getSenders"in mozRTCPeerConnection.prototype&&(U=!0):I.browser.isChrome&&"undefined"!=typeof webkitRTCPeerConnection&&"getSenders"in webkitRTCPeerConnection.prototype&&(U=!0),I.isRTPSenderReplaceTracksSupported=U;var V=!1;I.browser.isFirefox&&I.browser.version>38&&(V=!0),I.isRemoteStreamProcessingSupported=V;var W=!1;"undefined"!=typeof H&&"applyConstraints"in H.prototype&&(W=!0),I.isApplyConstraintsSupported=W;var X=!1;I.browser.isFirefox&&I.browser.version>=43&&(X=!0),I.isMultiMonitorScreenCapturingSupported=X,I.isPromisesSupported=!!("Promise"in window),"undefined"==typeof I&&(window.DetectRTC={});var Y=window.MediaStream;"undefined"==typeof Y&&"undefined"!=typeof webkitMediaStream&&(Y=webkitMediaStream),"undefined"!=typeof Y?I.MediaStream=Object.keys(Y.prototype):I.MediaStream=!1,"undefined"!=typeof H?I.MediaStreamTrack=Object.keys(H.prototype):I.MediaStreamTrack=!1;var Z=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;"undefined"!=typeof Z?I.RTCPeerConnection=Object.keys(Z.prototype):I.RTCPeerConnection=!1,
window.DetectRTC=I,"undefined"!=typeof module&&(module.exports=I),"function"==typeof define&&define.amd&&define("DetectRTC",[],function(){return I})}(),document.addEventListener("deviceready",B,!1),B();var E,C={};"undefined"!=typeof window.RTCPeerConnection?E=window.RTCPeerConnection:"undefined"!=typeof mozRTCPeerConnection?E=mozRTCPeerConnection:"undefined"!=typeof webkitRTCPeerConnection&&(E=webkitRTCPeerConnection);var F=window.RTCSessionDescription||window.mozRTCSessionDescription,G=window.RTCIceCandidate||window.mozRTCIceCandidate,H=window.MediaStreamTrack;window.onPluginRTCInitialized=function(){H=window.PluginRTC.MediaStreamTrack,E=window.PluginRTC.RTCPeerConnection,G=window.PluginRTC.RTCIceCandidate,F=window.PluginRTC.RTCSessionDescription},"undefined"!=typeof window.PluginRTC&&window.onPluginRTCInitialized();var J=function(){function b(a){if(!a||"string"!=typeof a)throw"Invalid arguments.";return a=a.replace("a=rtpmap:100 VP8/90000\r\n",""),a=a.replace("a=rtpmap:101 VP9/90000\r\n",""),a=a.replace(/m=video ([0-9]+) RTP\/SAVPF ([0-9 ]*) 100/g,"m=video $1 RTP/SAVPF $2"),a=a.replace(/m=video ([0-9]+) RTP\/SAVPF ([0-9 ]*) 101/g,"m=video $1 RTP/SAVPF $2"),a=a.replace(/m=video ([0-9]+) RTP\/SAVPF 100([0-9 ]*)/g,"m=video $1 RTP/SAVPF$2"),a=a.replace(/m=video ([0-9]+) RTP\/SAVPF 101([0-9 ]*)/g,"m=video $1 RTP/SAVPF$2"),a=a.replace("a=rtcp-fb:120 nack\r\n",""),a=a.replace("a=rtcp-fb:120 nack pli\r\n",""),a=a.replace("a=rtcp-fb:120 ccm fir\r\n",""),a=a.replace("a=rtcp-fb:101 nack\r\n",""),a=a.replace("a=rtcp-fb:101 nack pli\r\n",""),a=a.replace("a=rtcp-fb:101 ccm fir\r\n","")}function c(a){if(!a||"string"!=typeof a)throw"Invalid arguments.";return a=a.replace("a=rtcp-fb:126 nack\r\n",""),a=a.replace("a=rtcp-fb:126 nack pli\r\n","a=rtcp-fb:126 pli\r\n"),a=a.replace("a=rtcp-fb:97 nack\r\n",""),a=a.replace("a=rtcp-fb:97 nack pli\r\n","a=rtcp-fb:97 pli\r\n")}function d(a,b){if(b&&b.getSenders&&b.getSenders().length){if(!a||"string"!=typeof a)throw"Invalid arguments.";b.getSenders().forEach(function(b){for(var c=b.getParameters(),d=0;d<c.codecs.length;d++)if(c.codecs[d].mimeType==a){c.codecs.unshift(c.codecs.splice(d,1));break}b.setParameters(c)})}}function f(a){return a.replace(/m=audio ([0-9]+) RTP\/SAVPF ([0-9 ]*)/g,"m=audio $1 RTP/SAVPF 9")}function g(b,c,d){return c?"undefined"!=typeof e&&e?b:a?b:(d&&(c.screen?c.screen<300&&console.warn("It seems that you are using wrong bandwidth value for screen. Screen sharing is expected to fail."):console.warn("It seems that you are not using bandwidth for screen. Screen sharing is expected to fail.")),c.screen&&d&&(b=b.replace(/b=AS([^\r\n]+\r\n)/g,""),b=b.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+c.screen+"\r\n")),(c.audio||c.video||c.data)&&(b=b.replace(/b=AS([^\r\n]+\r\n)/g,"")),c.audio&&(b=b.replace(/a=mid:audio\r\n/g,"a=mid:audio\r\nb=AS:"+c.audio+"\r\n")),c.video&&(b=b.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+(d?c.screen:c.video)+"\r\n")),b):b}function h(a,b,c){return i(a,0,-1,b,c)}function i(a,b,c,d,e){for(var f=c!==-1?c:a.length,g=b;g<f;++g)if(0===a[g].indexOf(d)&&(!e||a[g].toLowerCase().indexOf(e.toLowerCase())!==-1))return g;return null}function j(a){var b=new RegExp("a=rtpmap:(\\d+) \\w+\\/\\d+"),c=a.match(b);return c&&2===c.length?c[1]:null}function k(b,c){if(a)return b;c=c||{};var i,d=c.min,e=c.max,f=b.split("\r\n"),g=h(f,"a=rtpmap","VP8/90000");if(g&&(i=j(f[g])),!i)return b;var l,k=h(f,"a=rtpmap","rtx/90000");if(k&&(l=j(f[k])),!k)return b;var m=h(f,"a=fmtp:"+l.toString());if(null!==m){var n="\r\n";n+="a=fmtp:"+i+" x-google-min-bitrate="+(d||"228")+"; x-google-max-bitrate="+(e||"228"),f[m]=f[m].concat(n),b=f.join("\r\n")}return b}function l(b,c){if(a)return b;c=c||{};var f,d=b.split("\r\n"),e=h(d,"a=rtpmap","opus/48000");if(e&&(f=j(d[e])),!f)return b;var g=h(d,"a=fmtp:"+f.toString());if(null===g)return b;var i="";return i+="; stereo="+("undefined"!=typeof c.stereo?c.stereo:"1"),i+="; sprop-stereo="+("undefined"!=typeof c["sprop-stereo"]?c["sprop-stereo"]:"1"),"undefined"!=typeof c.maxaveragebitrate&&(i+="; maxaveragebitrate="+(c.maxaveragebitrate||1048576)),"undefined"!=typeof c.maxplaybackrate&&(i+="; maxplaybackrate="+(c.maxplaybackrate||1048576)),"undefined"!=typeof c.cbr&&(i+="; cbr="+("undefined"!=typeof c.cbr?c.cbr:"1")),"undefined"!=typeof c.useinbandfec&&(i+="; useinbandfec="+c.useinbandfec),"undefined"!=typeof c.usedtx&&(i+="; usedtx="+c.usedtx),"undefined"!=typeof c.maxptime&&(i+="\r\na=maxptime:"+c.maxptime),d[g]=d[g].concat(i),b=d.join("\r\n")}function m(a){return a.indexOf("SAVPF 100 101")===-1||a.indexOf("VP9/90000")===-1?a:a.replace("SAVPF 100 101","SAVPF 101 100")}function n(a){for(var b=a.split("\r\n"),c=null,d=0;d<b.length;d++)if(b[d].search("opus/48000")!==-1){var e=extractSdp(b[d],/:(\d+) opus\/48000/i);break}for(var d=0;d<b.length;d++)if(b[d].search("a=fmtp")!==-1){var f=extractSdp(b[d],/a=fmtp:(\d+)/);if(f===e){c=d;break}}return null===c?a:(b[c]=b[c].concat("; stereo=1; sprop-stereo=1"),a=b.join("\r\n"))}var a=!!navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i);return"undefined"!=typeof cordova&&(a=!0),navigator&&navigator.userAgent&&navigator.userAgent.indexOf("Crosswalk")!==-1&&(a=!0),{removeVPX:b,disableNACK:c,prioritize:d,removeNonG722:f,setApplicationSpecificBandwidth:function(a,b,c){return g(a,b,c)},setVideoBitrates:function(a,b){return k(a,b)},setOpusAttributes:function(a,b){return l(a,b)},preferVP9:m,forceStereoAudio:n}}();window.BandwidthHandler=J;var M,K=function(){function a(a,b){var c=b.candidate,d=a.candidates,e=d.stun,f=d.turn;if(w(d.reflexive)||(e=d.reflexive),w(d.relay)||(f=d.relay),(d.host||!c.match(/typ host/g))&&(f||!c.match(/typ relay/g))&&(e||!c.match(/typ srflx/g))){var g=a.iceProtocols;if((g.udp||!c.match(/ udp /g))&&(g.tcp||!c.match(/ tcp /g)))return a.enableLogs&&console.debug("Your candidate pairs:",c),{candidate:c,sdpMid:b.sdpMid,sdpMLineIndex:b.sdpMLineIndex}}}return{processCandidates:a}}();"undefined"!=typeof window.getExternalIceServers&&1==window.getExternalIceServers&&N(function(a){a&&a.length&&(window.RMCExternalIceServers=a,window.iceServersLoadCallback&&"function"==typeof window.iceServersLoadCallback&&window.iceServersLoadCallback(a))});var R=function(){function a(a){var b=[];return b.push(O("stun:stun.l.google.com:19302")),b.push(P("turn:webrtcweb.com:80","muazkh","muazkh")),b.push(P("turn:webrtcweb.com:443","muazkh","muazkh")),window.RMCExternalIceServers?b=b.concat(Q()):"undefined"!=typeof window.getExternalIceServers&&1==window.getExternalIceServers&&(a.iceServers=b,window.iceServersLoadCallback=function(){a.iceServers=a.iceServers.concat(Q())}),b}return{getIceServers:a}}(),T={streams:[],mutex:!1,queueRequests:[],remove:function(a){this.mutex=!1;var b=this.streams[a];if(b){b=b.stream;var c=b.currentUserMediaRequestOptions;this.queueRequests.indexOf(c)&&(delete this.queueRequests[this.queueRequests.indexOf(c)],this.queueRequests=u(this.queueRequests)),this.streams[a].stream=null,delete this.streams[a]}}},V=function(){function a(a){if(a)return"string"==typeof a||"undefined"==typeof a?a:a.audio&&a.video?null:a.audio?"audio":a.video?"video":void 0}function b(b,d,e){function g(){if(e.streamEvents[b.streamid].mediaElement){var a=e.streamEvents[b.streamid].mediaElement;a.volume=0,c(200,5,function(){a.volume+=.2})}}if(b&&b.addEventListener){if("undefined"==typeof d||1==d){var f="ended";"oninactive"in b&&(f="inactive"),b.addEventListener(f,function(){V.onSyncNeeded(this.streamid,f)},!1)}b.mute=function(c,f){c=a(c),"undefined"!=typeof f&&(d=f),"undefined"!=typeof c&&"audio"!=c||b.getAudioTracks().forEach(function(a){a.enabled=!1,e.streamEvents[b.streamid].isAudioMuted=!0}),"undefined"!=typeof c&&"video"!=c||b.getVideoTracks().forEach(function(a){a.enabled=!1}),"undefined"!=typeof d&&1!=d||V.onSyncNeeded(b.streamid,"mute",c),e.streamEvents[b.streamid].muteType=c||"both",o(b,"mute",c)},b.unmute=function(c,f){c=a(c),"undefined"!=typeof f&&(d=f),g(),"undefined"!=typeof c&&"audio"!=c||b.getAudioTracks().forEach(function(a){a.enabled=!0,e.streamEvents[b.streamid].isAudioMuted=!1}),"undefined"!=typeof c&&"video"!=c||(b.getVideoTracks().forEach(function(a){a.enabled=!0}),"undefined"!=typeof c&&"video"==c&&e.streamEvents[b.streamid].isAudioMuted&&!function a(c){c||(c=0),c++,c<100&&e.streamEvents[b.streamid].isAudioMuted&&(b.mute("audio"),setTimeout(function(){a(c)},50))}()),"undefined"!=typeof d&&1!=d||V.onSyncNeeded(b.streamid,"unmute",c),e.streamEvents[b.streamid].unmuteType=c||"both",o(b,"unmute",c)}}}function c(a,b,d,e){e=(e||0)+1,e>=b||setTimeout(function(){d(),c(a,b,d,e)},a)}return{setHandlers:b,onSyncNeeded:function(a,b,c){}}}();window.addEventListener("message",function(a){a.origin==window.location.origin&&W(a.data)});var Y,Z,X="screen",ea={send:function(a){function k(a,e){var l={type:"text",uuid:i,sendingTime:j};a&&(e=a,l.packets=parseInt(e.length/f)),e.length>f?l.message=e.slice(0,f):(l.message=e,l.last=!0,l.isobject=h),c.send(l,d),g=e.slice(l.message.length),g.length&&setTimeout(function(){k(null,g)},b.chunkInterval||100)}var b=a.connection,c=a.channel,d=a.remoteUserId,e=a.text,f=b.chunkSize||1e3,g="",h=!1;x(e)||(h=!0,e=JSON.stringify(e));var i=r(),j=(new Date).getTime();k(e)}},fa=function(){function a(a){function c(a,b){if(a.position!==-1){var c=+a.position.toFixed(2).split(".")[1]||100;b.innerHTML=c+"%"}}var b={};a.onFileStart=function(c){var d=document.createElement("div");return d.title=c.name,d.innerHTML="<label>0%</label> <progress></progress>",c.remoteUserId&&(d.innerHTML+=" (Sharing with:"+c.remoteUserId+")"),a.filesContainer||(a.filesContainer=document.body||document.documentElement),a.filesContainer.insertBefore(d,a.filesContainer.firstChild),c.remoteUserId?(b[c.uuid]||(b[c.uuid]={}),b[c.uuid][c.remoteUserId]={div:d,progress:d.querySelector("progress"),label:d.querySelector("label")},void(b[c.uuid][c.remoteUserId].progress.max=c.maxChunks)):(b[c.uuid]={div:d,progress:d.querySelector("progress"),label:d.querySelector("label")},void(b[c.uuid].progress.max=c.maxChunks))},a.onFileProgress=function(a){var d=b[a.uuid];d&&(a.remoteUserId&&!(d=b[a.uuid][a.remoteUserId])||(d.progress.value=a.currentPosition||a.maxChunks||d.progress.max,c(d.progress,d.label)))},a.onFileEnd=function(a){var c=b[a.uuid];if(!c)return void console.error("No such progress-helper element exists.",a);if(!a.remoteUserId||(c=b[a.uuid][a.remoteUserId])){var d=c.div;a.type.indexOf("image")!=-1?d.innerHTML='<a href="'+a.url+'" download="'+a.name+'">Download <strong style="color:red;">'+a.name+'</strong> </a><br /><img src="'+a.url+'" title="'+a.name+'" style="max-width: 80%;">':d.innerHTML='<a href="'+a.url+'" download="'+a.name+'">Download <strong style="color:red;">'+a.name+'</strong> </a><br /><iframe src="'+a.url+'" title="'+a.name+'" style="width: 80%;border: 0;height: inherit;margin-top:1em;"></iframe>'}}}return{handle:a}}(),ga=function(){function a(a){a.autoTranslateText=!1,a.language="en",a.googKey="AIzaSyCgB5hmFY74WYB-EoWkhr9cAGr6TiTHrEE",a.Translator={TranslateText:function(b,c){var d=document.createElement("script");d.type="text/javascript";var e=encodeURIComponent(b),f="method"+a.token();window[f]=function(a){a.data&&a.data.translations[0]&&c&&c(a.data.translations[0].translatedText),a.error&&"Daily Limit Exceeded"===a.error.message&&(warn('Text translation failed. Error message: "Daily Limit Exceeded."'),c(b))};var g="https://www.googleapis.com/language/translate/v2?key="+a.googKey+"&target="+(a.language||"en-US")+"&callback=window."+f+"&q="+e;d.src=g,document.getElementsByTagName("head")[0].appendChild(d)}}}return{handle:a}}();window.RTCMultiConnection=a}()}