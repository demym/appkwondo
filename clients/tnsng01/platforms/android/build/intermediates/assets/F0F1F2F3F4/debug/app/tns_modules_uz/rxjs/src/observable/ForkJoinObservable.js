"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var Observable_1 = require("../Observable");
var EmptyObservable_1 = require("./EmptyObservable");
var isArray_1 = require("../util/isArray");
var subscribeToResult_1 = require("../util/subscribeToResult");
var OuterSubscriber_1 = require("../OuterSubscriber");
var ForkJoinObservable = (function (_super) {
    __extends(ForkJoinObservable, _super);
    function ForkJoinObservable(sources, resultSelector) {
        var _this = _super.call(this) || this;
        _this.sources = sources;
        _this.resultSelector = resultSelector;
        return _this;
    }
    ForkJoinObservable.create = function () {
        var sources = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            sources[_i] = arguments[_i];
        }
        if (sources === null || arguments.length === 0) {
            return new EmptyObservable_1.EmptyObservable();
        }
        var resultSelector = null;
        if (typeof sources[sources.length - 1] === 'function') {
            resultSelector = sources.pop();
        }
        if (sources.length === 1 && isArray_1.isArray(sources[0])) {
            sources = sources[0];
        }
        if (sources.length === 0) {
            return new EmptyObservable_1.EmptyObservable();
        }
        return new ForkJoinObservable(sources, resultSelector);
    };
    ForkJoinObservable.prototype._subscribe = function (subscriber) {
        return new ForkJoinSubscriber(subscriber, this.sources, this.resultSelector);
    };
    return ForkJoinObservable;
}(Observable_1.Observable));
exports.ForkJoinObservable = ForkJoinObservable;
var ForkJoinSubscriber = (function (_super) {
    __extends(ForkJoinSubscriber, _super);
    function ForkJoinSubscriber(destination, sources, resultSelector) {
        var _this = _super.call(this, destination) || this;
        _this.sources = sources;
        _this.resultSelector = resultSelector;
        _this.completed = 0;
        _this.haveValues = 0;
        var len = sources.length;
        _this.total = len;
        _this.values = new Array(len);
        for (var i = 0; i < len; i++) {
            var source = sources[i];
            var innerSubscription = subscribeToResult_1.subscribeToResult(_this, source, null, i);
            if (innerSubscription) {
                innerSubscription.outerIndex = i;
                _this.add(innerSubscription);
            }
        }
        return _this;
    }
    ForkJoinSubscriber.prototype.notifyNext = function (outerValue, innerValue, outerIndex, innerIndex, innerSub) {
        this.values[outerIndex] = innerValue;
        if (!innerSub._hasValue) {
            innerSub._hasValue = true;
            this.haveValues++;
        }
    };
    ForkJoinSubscriber.prototype.notifyComplete = function (innerSub) {
        var destination = this.destination;
        var _a = this, haveValues = _a.haveValues, resultSelector = _a.resultSelector, values = _a.values;
        var len = values.length;
        if (!innerSub._hasValue) {
            destination.complete();
            return;
        }
        this.completed++;
        if (this.completed !== len) {
            return;
        }
        if (haveValues === len) {
            var value = resultSelector ? resultSelector.apply(this, values) : values;
            destination.next(value);
        }
        destination.complete();
    };
    return ForkJoinSubscriber;
}(OuterSubscriber_1.OuterSubscriber));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRm9ya0pvaW5PYnNlcnZhYmxlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiRm9ya0pvaW5PYnNlcnZhYmxlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUFBLDRDQUFrRTtBQUdsRSxxREFBb0Q7QUFDcEQsMkNBQTBDO0FBRTFDLCtEQUE4RDtBQUM5RCxzREFBcUQ7QUFRckQ7SUFBMkMsc0NBQWE7SUFDdEQsNEJBQW9CLE9BQTBDLEVBQzFDLGNBQTZDO1FBRGpFLFlBRUUsaUJBQU8sU0FDUjtRQUhtQixhQUFPLEdBQVAsT0FBTyxDQUFtQztRQUMxQyxvQkFBYyxHQUFkLGNBQWMsQ0FBK0I7O0lBRWpFLENBQUM7SUE2Qk0seUJBQU0sR0FBYjtRQUFpQixpQkFFZ0Q7YUFGaEQsVUFFZ0QsRUFGaEQscUJBRWdELEVBRmhELElBRWdEO1lBRmhELDRCQUVnRDs7UUFDL0QsRUFBRSxDQUFDLENBQUMsT0FBTyxLQUFLLElBQUksSUFBSSxTQUFTLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDL0MsTUFBTSxDQUFDLElBQUksaUNBQWUsRUFBSyxDQUFDO1FBQ2xDLENBQUM7UUFFRCxJQUFJLGNBQWMsR0FBbUMsSUFBSSxDQUFDO1FBQzFELEVBQUUsQ0FBQyxDQUFDLE9BQU8sT0FBTyxDQUFDLE9BQU8sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLEtBQUssVUFBVSxDQUFDLENBQUMsQ0FBQztZQUN0RCxjQUFjLEdBQW1DLE9BQU8sQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUNqRSxDQUFDO1FBSUQsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLE1BQU0sS0FBSyxDQUFDLElBQUksaUJBQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDaEQsT0FBTyxHQUFzQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDMUQsQ0FBQztRQUVELEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FB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QUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxHQUFHLE1BQU0sQ0FBQztZQUMzRSxXQUFXLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzFCLENBQUM7UUFFRCxXQUFXLENBQUMsUUFBUSxFQUFFLENBQUM7SUFDekIsQ0FBQztJQUNILHlCQUFDO0FBQUQsQ0FBQyxBQTNERCxDQUFvQyxpQ0FBZSxHQTJEbEQiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBPYnNlcnZhYmxlLCBTdWJzY3JpYmFibGVPclByb21pc2UgfSBmcm9tICcuLi9PYnNlcnZhYmxlJztcbmltcG9ydCB7IFN1YnNjcmliZXIgfSBmcm9tICcuLi9TdWJzY3JpYmVyJztcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJy4uL1N1YnNjcmlwdGlvbic7XG5pbXBvcnQgeyBFbXB0eU9ic2VydmFibGUgfSBmcm9tICcuL0VtcHR5T2JzZXJ2YWJsZSc7XG5pbXBvcnQgeyBpc0FycmF5IH0gZnJvbSAnLi4vdXRpbC9pc0FycmF5JztcblxuaW1wb3J0IHsgc3Vic2NyaWJlVG9SZXN1bHQgfSBmcm9tICcuLi91dGlsL3N1YnNjcmliZVRvUmVzdWx0JztcbmltcG9ydCB7IE91dGVyU3Vic2NyaWJlciB9IGZyb20gJy4uL091dGVyU3Vic2NyaWJlcic7XG5pbXBvcnQgeyBJbm5lclN1YnNjcmliZXIgfSBmcm9tICcuLi9Jbm5lclN1YnNjcmliZXInO1xuXG4vKipcbiAqIFdlIG5lZWQgdGhpcyBKU0RvYyBjb21tZW50IGZvciBhZmZlY3RpbmcgRVNEb2MuXG4gKiBAZXh0ZW5kcyB7SWdub3JlZH1cbiAqIEBoaWRlIHRydWVcbiAqL1xuZXhwb3J0IGNsYXNzIEZvcmtKb2luT2JzZXJ2YWJsZTxUPiBleHRlbmRzIE9ic2VydmFibGU8VD4ge1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHNvdXJjZXM6IEFycmF5PFN1YnNjcmliYWJsZU9yUHJvbWlzZTxhbnk+PixcbiAgICAgICAgICAgICAgcHJpdmF0ZSByZXN1bHRTZWxlY3Rvcj86ICguLi52YWx1ZXM6IEFycmF5PGFueT4pID0+IFQpIHtcbiAgICBzdXBlcigpO1xuICB9XG5cbiAgLyogdHNsaW50OmRpc2FibGU6bWF4LWxpbmUtbGVuZ3RoICovXG4gIHN0YXRpYyBjcmVhdGU8VCwgVDI+KHYxOiBTdWJzY3JpYmFibGVPclByb21pc2U8VD4sIHYyOiBTdWJzY3JpYmFibGVPclByb21pc2U8VDI+KTogT2JzZXJ2YWJsZTxbVCwgVDJdPjtcbiAgc3RhdGljIGNyZWF0ZTxULCBUMiwgVDM+KHYxOiBTdWJzY3JpYmFibGVPclByb21pc2U8VD4sIHYyOiBTdWJzY3JpYmFibGVPclByb21pc2U8VDI+LCB2MzogU3Vic2NyaWJhYmxlT3JQcm9taXNlPFQzPik6IE9ic2VydmFibGU8W1QsIFQyLCBUM10+O1xuICBzdGF0aWMgY3JlYXRlPFQsIFQyLCBUMywgVDQ+KHYxOiBTdWJzY3JpYmFibGVPclByb21pc2U8VD4sIHYyOiBTdWJzY3JpYmFibGVPclByb21pc2U8VDI+LCB2MzogU3Vic2NyaWJhYmxlT3JQcm9taXNlPFQzPiwgdjQ6IFN1YnNjcmliYWJsZU9yUHJvbWlzZTxUND4pOiBPYnNlcnZhYmxlPFtULCBUMiwgVDMsIFQ0XT47XG4gIHN0YXRpYyBjcmVhdGU8VCwgVDIsIFQzLCBUNCwgVDU+KHYxOiBTdWJzY3JpYmFibGVPclByb21pc2U8VD4sIHYyOiBTdWJzY3JpYmFibGVPclByb21pc2U8VDI+LCB2MzogU3Vic2NyaWJhYmxlT3JQcm9taXNlPFQzPiwgdjQ6IFN1YnNjcmliYWJsZU9yUHJvbWlzZTxUND4sIHY1OiBTdWJzY3JpYmFibGVPclByb21pc2U8VDU+KTogT2JzZXJ2YWJsZTxbVCwgVDIsIFQzLCBUNCwgVDVdPjtcbiAgc3RhdGljIGNyZWF0ZTxULCBUMiwgVDMsIFQ0LCBUNSwgVDY+KHYxOiBTdWJzY3JpYmFibGVPclByb21pc2U8VD4sIHYyOiBTdWJzY3JpYmFibGVPclByb21pc2U8VDI+LCB2MzogU3Vic2NyaWJhYmxlT3JQcm9taXNlPFQzPiwgdjQ6IFN1YnNjcmliYWJsZU9yUHJvbWlzZTxUND4sIHY1OiBTdWJzY3JpYmFibGVPclByb21pc2U8VDU+LCB2NjogU3Vic2NyaWJhYmxlT3JQcm9taXNlPFQ2Pik6IE9ic2VydmFibGU8W1QsIFQyLCBUMywgVDQsIFQ1LCBUNl0+O1xuICBzdGF0aWMgY3JlYXRlPFQsIFI+KHYxOiBTdWJzY3JpYmFibGVPclByb21pc2U8VD4sIHByb2plY3Q6ICh2MTogVCkgPT4gUik6IE9ic2VydmFibGU8Uj47XG4gIHN0YXRpYyBjcmVhdGU8VCwgVDIsIFI+KHYxOiBTdWJzY3JpYmFibGVPclByb21pc2U8VD4sIHYyOiBTdWJzY3JpYmFibGVPclByb21pc2U8VDI+LCBwcm9qZWN0OiAodjE6IFQsIHYyOiBUMikgPT4gUik6IE9ic2VydmFibGU8Uj47XG4gIHN0YXRpYyBjcmVhdGU8VCwgVDIsIFQzLCBSPih2MTogU3Vic2NyaWJhYmxlT3JQcm9taXNlPFQ+LCB2MjogU3Vic2NyaWJhYmxlT3JQcm9taXNlPFQyPiwgdjM6IFN1YnNjcmliYWJsZU9yUHJvbWlzZTxUMz4sIHByb2plY3Q6ICh2MTogVCwgdjI6IFQyLCB2MzogVDMpID0+IFIpOiBPYnNlcnZhYmxlPFI+O1xuICBzdGF0aWMgY3JlYXRlPFQsIFQyLCBUMywgVDQsIFI+KHYxOiBTdWJzY3JpYmFibGVPclByb21pc2U8VD4sIHYyOiBTdWJzY3JpYmFibGVPclByb21pc2U8VDI+LCB2MzogU3Vic2NyaWJhYmxlT3JQcm9taXNlPFQzPiwgdjQ6IFN1YnNjcmliYWJsZU9yUHJvbWlzZTxUND4sIHByb2plY3Q6ICh2MTogVCwgdjI6IFQyLCB2MzogVDMsIHY0OiBUNCkgPT4gUik6IE9ic2VydmFibGU8Uj47XG4gIHN0YXRpYyBjcmVhdGU8VCwgVDIsIFQzLCBUNCwgVDUsIFI+KHYxOiBTdWJzY3JpYmFibGVPclByb21pc2U8VD4sIHYyOiBTdWJzY3JpYmFibGVPclByb21pc2U8VDI+LCB2MzogU3Vic2NyaWJhYmxlT3JQcm9taXNlPFQzPiwgdjQ6IFN1YnNjcmliYWJsZU9yUHJvbWlzZTxUND4sIHY1OiBTdWJzY3JpYmFibGVPclByb21pc2U8VDU+LCBwcm9qZWN0OiAodjE6IFQsIHYyOiBUMiwgdjM6IFQzLCB2NDogVDQsIHY1OiBUNSkgPT4gUik6IE9ic2VydmFibGU8Uj47XG4gIHN0YXRpYyBjcmVhdGU8VCwgVDIsIFQzLCBUNCwgVDUsIFQ2LCBSPih2MTogU3Vic2NyaWJhYmxlT3JQcm9taXNlPFQ+LCB2MjogU3Vic2NyaWJhYmxlT3JQcm9taXNlPFQyPiwgdjM6IFN1YnNjcmliYWJsZU9yUHJvbWlzZTxUMz4sIHY0OiBTdWJzY3JpYmFibGVPclByb21pc2U8VDQ+LCB2NTogU3Vic2NyaWJhYmxlT3JQcm9taXNlPFQ1PiwgdjY6IFN1YnNjcmliYWJsZU9yUHJvbWlzZTxUNj4sIHByb2plY3Q6ICh2MTogVCwgdjI6IFQyLCB2MzogVDMsIHY0OiBUNCwgdjU6IFQ1LCB2NjogVDYpID0+IFIpOiBPYnNlcnZhYmxlPFI+O1xuICBzdGF0aWMgY3JlYXRlPFQ+KHNvdXJjZXM6IFN1YnNjcmliYWJsZU9yUHJvbWlzZTxUPltdKTogT2JzZXJ2YWJsZTxUW10+O1xuICBzdGF0aWMgY3JlYXRlPFI+KHNvdXJjZXM6IFN1YnNjcmliYWJsZU9yUHJvbWlzZTxhbnk+W10pOiBPYnNlcnZhYmxlPFI+O1xuICBzdGF0aWMgY3JlYXRlPFQsIFI+KHNvdXJjZXM6IFN1YnNjcmliYWJsZU9yUHJvbWlzZTxUPltdLCBwcm9qZWN0OiAoLi4udmFsdWVzOiBBcnJheTxUPikgPT4gUik6IE9ic2VydmFibGU8Uj47XG4gIHN0YXRpYyBjcmVhdGU8Uj4oc291cmNlczogU3Vic2NyaWJhYmxlT3JQcm9taXNlPGFueT5bXSwgcHJvamVjdDogKC4uLnZhbHVlczogQXJyYXk8YW55PikgPT4gUik6IE9ic2VydmFibGU8Uj47XG4gIHN0YXRpYyBjcmVhdGU8VD4oLi4uc291cmNlczogU3Vic2NyaWJhYmxlT3JQcm9taXNlPFQ+W10pOiBPYnNlcnZhYmxlPFRbXT47XG4gIHN0YXRpYyBjcmVhdGU8Uj4oLi4uc291cmNlczogU3Vic2NyaWJhYmxlT3JQcm9taXNlPGFueT5bXSk6IE9ic2VydmFibGU8Uj47XG4gIC8qIHRzbGludDplbmFibGU6bWF4LWxpbmUtbGVuZ3RoICovXG5cbiAgLyoqXG4gICAqIEBwYXJhbSBzb3VyY2VzXG4gICAqIEByZXR1cm4ge2FueX1cbiAgICogQHN0YXRpYyB0cnVlXG4gICAqIEBuYW1lIGZvcmtKb2luXG4gICAqIEBvd25lciBPYnNlcnZhYmxlXG4gICAqL1xuICBzdGF0aWMgY3JlYXRlPFQ+KC4uLnNvdXJjZXM6IEFycmF5PFN1YnNjcmliYWJsZU9yUHJvbWlzZTxhbnk+IHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBcnJheTxTdWJzY3JpYmFibGVPclByb21pc2U8YW55Pj4gfFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICgoLi4udmFsdWVzOiBBcnJheTxhbnk+KSA9PiBhbnkpPik6IE9ic2VydmFibGU8VD4ge1xuICAgIGlmIChzb3VyY2VzID09PSBudWxsIHx8IGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiBuZXcgRW1wdHlPYnNlcnZhYmxlPFQ+KCk7XG4gICAgfVxuXG4gICAgbGV0IHJlc3VsdFNlbGVjdG9yOiAoLi4udmFsdWVzOiBBcnJheTxhbnk+KSA9PiBhbnkgPSBudWxsO1xuICAgIGlmICh0eXBlb2Ygc291cmNlc1tzb3VyY2VzLmxlbmd0aCAtIDFdID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICByZXN1bHRTZWxlY3RvciA9IDwoLi4udmFsdWVzOiBBcnJheTxhbnk+KSA9PiBhbnk+c291cmNlcy5wb3AoKTtcbiAgICB9XG5cbiAgICAvLyBpZiB0aGUgZmlyc3QgYW5kIG9ubHkgb3RoZXIgYXJndW1lbnQgYmVzaWRlcyB0aGUgcmVzdWx0U2VsZWN0b3IgaXMgYW4gYXJyYXlcbiAgICAvLyBhc3N1bWUgaXQncyBiZWVuIGNhbGxlZCB3aXRoIGBmb3JrSm9pbihbb2JzMSwgb2JzMiwgb2JzM10sIHJlc3VsdFNlbGVjdG9yKWBcbiAgICBpZiAoc291cmNlcy5sZW5ndGggPT09IDEgJiYgaXNBcnJheShzb3VyY2VzWzBdKSkge1xuICAgICAgc291cmNlcyA9IDxBcnJheTxTdWJzY3JpYmFibGVPclByb21pc2U8YW55Pj4+c291cmNlc1swXTtcbiAgICB9XG5cbiAgICBpZiAoc291cmNlcy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiBuZXcgRW1wdHlPYnNlcnZhYmxlPFQ+KCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG5ldyBGb3JrSm9pbk9ic2VydmFibGUoPEFycmF5PFN1YnNjcmliYWJsZU9yUHJvbWlzZTxhbnk+Pj5zb3VyY2VzLCByZXN1bHRTZWxlY3Rvcik7XG4gIH1cblxuICBwcm90ZWN0ZWQgX3N1YnNjcmliZShzdWJzY3JpYmVyOiBTdWJzY3JpYmVyPGFueT4pOiBTdWJzY3JpcHRpb24ge1xuICAgIHJldHVybiBuZXcgRm9ya0pvaW5TdWJzY3JpYmVyKHN1YnNjcmliZXIsIHRoaXMuc291cmNlcywgdGhpcy5yZXN1bHRTZWxlY3Rvcik7XG4gIH1cbn1cblxuLyoqXG4gKiBXZSBuZWVkIHRoaXMgSlNEb2MgY29tbWVudCBmb3IgYWZmZWN0aW5nIEVTRG9jLlxuICogQGlnbm9yZVxuICogQGV4dGVuZHMge0lnbm9yZWR9XG4gKi9cbmNsYXNzIEZvcmtKb2luU3Vic2NyaWJlcjxUPiBleHRlbmRzIE91dGVyU3Vic2NyaWJlcjxULCBUPiB7XG4gIHByaXZhdGUgY29tcGxldGVkID0gMDtcbiAgcHJpdmF0ZSB0b3RhbDogbnVtYmVyO1xuICBwcml2YXRlIHZhbHVlczogYW55W107XG4gIHByaXZhdGUgaGF2ZVZhbHVlcyA9IDA7XG5cbiAgY29uc3RydWN0b3IoZGVzdGluYXRpb246IFN1YnNjcmliZXI8VD4sXG4gICAgICAgICAgICAgIHByaXZhdGUgc291cmNlczogQXJyYXk8U3Vic2NyaWJhYmxlT3JQcm9taXNlPGFueT4+LFxuICAgICAgICAgICAgICBwcml2YXRlIHJlc3VsdFNlbGVjdG9yPzogKC4uLnZhbHVlczogQXJyYXk8YW55PikgPT4gVCkge1xuICAgIHN1cGVyKGRlc3RpbmF0aW9uKTtcblxuICAgIGNvbnN0IGxlbiA9IHNvdXJjZXMubGVuZ3RoO1xuICAgIHRoaXMudG90YWwgPSBsZW47XG4gICAgdGhpcy52YWx1ZXMgPSBuZXcgQXJyYXkobGVuKTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgIGNvbnN0IHNvdXJjZSA9IHNvdXJjZXNbaV07XG4gICAgICBjb25zdCBpbm5lclN1YnNjcmlwdGlvbiA9IHN1YnNjcmliZVRvUmVzdWx0KHRoaXMsIHNvdXJjZSwgbnVsbCwgaSk7XG5cbiAgICAgIGlmIChpbm5lclN1YnNjcmlwdGlvbikge1xuICAgICAgICAoPGFueT4gaW5uZXJTdWJzY3JpcHRpb24pLm91dGVySW5kZXggPSBpO1xuICAgICAgICB0aGlzLmFkZChpbm5lclN1YnNjcmlwdGlvbik7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgbm90aWZ5TmV4dChvdXRlclZhbHVlOiBhbnksIGlubmVyVmFsdWU6IFQsXG4gICAgICAgICAgICAgb3V0ZXJJbmRleDogbnVtYmVyLCBpbm5lckluZGV4OiBudW1iZXIsXG4gICAgICAgICAgICAgaW5uZXJTdWI6IElubmVyU3Vic2NyaWJlcjxULCBUPik6IHZvaWQge1xuICAgIHRoaXMudmFsdWVzW291dGVySW5kZXhdID0gaW5uZXJWYWx1ZTtcbiAgICBpZiAoISg8YW55PmlubmVyU3ViKS5faGFzVmFsdWUpIHtcbiAgICAgICg8YW55PmlubmVyU3ViKS5faGFzVmFsdWUgPSB0cnVlO1xuICAgICAgdGhpcy5oYXZlVmFsdWVzKys7XG4gICAgfVxuICB9XG5cbiAgbm90aWZ5Q29tcGxldGUoaW5uZXJTdWI6IElubmVyU3Vic2NyaWJlcjxULCBUPik6IHZvaWQge1xuICAgIGNvbnN0IGRlc3RpbmF0aW9uID0gdGhpcy5kZXN0aW5hdGlvbjtcbiAgICBjb25zdCB7IGhhdmVWYWx1ZXMsIHJlc3VsdFNlbGVjdG9yLCB2YWx1ZXMgfSA9IHRoaXM7XG4gICAgY29uc3QgbGVuID0gdmFsdWVzLmxlbmd0aDtcblxuICAgIGlmICghKDxhbnk+aW5uZXJTdWIpLl9oYXNWYWx1ZSkge1xuICAgICAgZGVzdGluYXRpb24uY29tcGxldGUoKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmNvbXBsZXRlZCsrO1xuXG4gICAgaWYgKHRoaXMuY29tcGxldGVkICE9PSBsZW4pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoaGF2ZVZhbHVlcyA9PT0gbGVuKSB7XG4gICAgICBjb25zdCB2YWx1ZSA9IHJlc3VsdFNlbGVjdG9yID8gcmVzdWx0U2VsZWN0b3IuYXBwbHkodGhpcywgdmFsdWVzKSA6IHZhbHVlcztcbiAgICAgIGRlc3RpbmF0aW9uLm5leHQodmFsdWUpO1xuICAgIH1cblxuICAgIGRlc3RpbmF0aW9uLmNvbXBsZXRlKCk7XG4gIH1cbn0iXX0=